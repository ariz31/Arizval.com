<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Interactive Mind Map: Engineering Data Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMckDMOe6bvJOiFnO4IMUYLz3G92BIUKEp5nA7C8MFFKSSJTI" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-light: #f8fafc; --bg-dark: #0b1120;
            --node-bg-light: #ffffff; --node-bg-dark: #1e293b;
            --text-light: #1e293b; --text-dark: #e2e8f0;
            --border-light: #cbd5e1; --border-dark: #475569;
            --link-light: #94a3b8; --link-dark: #64748b;
            --primary-light: #3b82f6; --primary-dark: #60a5fa;
            --primary-text-light: #ffffff; --primary-text-dark: #0b1120;
            --highlight-border-light: #ef4444; /* Red-500 */
            --highlight-border-dark: #f87171; /* Red-400 */
            
            --cat-bg-expanded-light: #e0e7ff; --cat-border-expanded-light: #a5b4fc; --cat-text-expanded-light: #3730a3;
            --cat-bg-collapsed-light: #e5e7eb; --cat-border-collapsed-light: #9ca3af; --cat-text-collapsed-light: #4b5563;
            --cat-bg-expanded-dark: #312e81; --cat-border-expanded-dark: #818cf8; --cat-text-expanded-dark: #e0e7ff;
            --cat-bg-collapsed-dark: #374151; --cat-border-collapsed-dark: #6b7280; --cat-text-collapsed-dark: #d1d5db;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Inter', sans-serif;
            background-color: var(--bg-light); transition: background-color 0.3s ease;
        }
        body.dark { background-color: var(--bg-dark); }
        #mind-map-container, #list-view-container { width: 100%; height: 100%; position: relative; box-sizing: border-box; }
        #mind-map-container { cursor: grab; }
        #mind-map-container:active { cursor: grabbing; }

        .node { cursor: pointer; }
        .node rect {
            stroke-width: 2.5px; rx: 8; ry: 8;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
            transition: fill 0.3s ease, stroke 0.3s ease, transform 0.2s ease, stroke-width 0.2s ease;
        }
        .node:hover rect { transform: scale(1.05); }
        .node text { pointer-events: none; text-anchor: middle; dominant-baseline: central; font-weight: 500; transition: fill 0.3s ease; }
        .link { stroke-opacity: 0.7; transition: stroke 0.3s ease; }
        .katex { font-size: 1.1em; }

        .node.level-0 rect { fill: var(--primary-light); stroke: var(--primary-light); }
        .node.level-0 text { fill: var(--primary-text-light); font-size: 16px; font-weight: 700; }
        .node.level-1 rect { fill: var(--cat-bg-expanded-light); stroke: var(--cat-border-expanded-light); }
        .node.level-1 text { fill: var(--cat-text-expanded-light); font-size: 14px; font-weight: 600; }
        .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-light); stroke: var(--cat-border-collapsed-light); }
        .node.level-1.collapsed text { fill: var(--cat-text-collapsed-light); }
        .node.level-2 rect { fill: var(--node-bg-light); stroke: var(--border-light); }
        .node.level-2 text { fill: var(--text-light); font-size: 12px; }
        .link { stroke: var(--link-light); }
        
        body.dark .node.level-0 rect { fill: var(--primary-dark); stroke: var(--primary-dark); }
        body.dark .node.level-0 text { fill: var(--primary-text-dark); }
        body.dark .node.level-1 rect { fill: var(--cat-bg-expanded-dark); stroke: var(--cat-border-expanded-dark); }
        body.dark .node.level-1 text { fill: var(--cat-text-expanded-dark); }
        body.dark .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-dark); stroke: var(--cat-border-collapsed-dark); }
        body.dark .node.level-1.collapsed text { fill: var(--cat-text-collapsed-dark); }
        body.dark .node.level-2 rect { fill: var(--node-bg-dark); stroke: var(--border-dark); }
        body.dark .node.level-2 text { fill: var(--text-dark); }
        body.dark .link { stroke: var(--link-dark); }

        .node.highlight rect { stroke: var(--highlight-border-light); stroke-width: 4px; }
        body.dark .node.highlight rect { stroke: var(--highlight-border-dark); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--node-bg-light); color: var(--text-light); padding: 1.5rem; border-radius: 0.75rem; max-width: 90%; width: 600px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal-overlay.active .modal-content { transform: scale(1); }
        body.dark .modal-content { background: var(--node-bg-dark); color: var(--text-dark); }
        .modal-content h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark .modal-content h2 { color: var(--primary-dark); }
        .modal-content h3 { font-size: 1.15rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-light); }
        body.dark .modal-content h3 { color: var(--primary-dark); }
        .modal-content ul { padding-left: 1.5rem; margin-top: 0.5rem; }
        .modal-content li { margin-bottom: 0.25rem; }
        .modal-content code { background-color: #e2e8f0; color: #1e293b; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; }
        body.dark .modal-content code { background-color: #475569; color: #e2e8f0; }

        #toolbar { position: fixed; z-index: 500; top: 50%; right: 1rem; transform: translateY(-50%); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
        #toolbar.expanded { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(200, 200, 200, 0.5); border-radius: 9999px; padding: 0.5rem; }
        body.dark #toolbar.expanded { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(71, 85, 105, 0.5); }
        #toolbar-tools { display: flex; flex-direction: column; gap: 0.5rem; max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.25, 1, 0.5, 1), padding 0.5s ease; }
        #toolbar.expanded #toolbar-tools { max-height: 500px; }
        .toolbar-divider { width: 80%; height: 1px; margin: 0.25rem auto; background-color: #e2e8f0; }
        body.dark .toolbar-divider { background-color: #475569; }

        #list-view-container { padding: 2rem; overflow-y: auto; background-color: var(--bg-light); color: var(--text-light); box-sizing: border-box; height: 100%; }
        body.dark #list-view-container { background-color: var(--bg-dark); color: var(--text-dark); }
        #list-view-container h1 { font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark #list-view-container h1 { color: var(--primary-dark); }
        #list-view-container h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 2px solid var(--border-light); padding-bottom: 0.5rem; }
        body.dark #list-view-container h2 { border-bottom-color: var(--border-dark); }
        #list-view-container ul { list-style: none; padding-left: 1rem; }
        #list-view-container li { padding: 0.5rem; margin: 0.25rem 0; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; }
        #list-view-container li:hover { background-color: rgba(0,0,0,0.05); }
        body.dark #list-view-container li:hover { background-color: rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div id="mind-map-container"></div>
    <div id="list-view-container" class="hidden"></div>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modal-title"></h2>
                <button id="close-modal-info" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <div id="share-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">Share Mind Map</h2>
                <button id="close-modal-share" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">&times;</button>
            </div>
            <div class="space-y-4">
                <p class="text-sm text-gray-600 dark:text-gray-400">Share this interactive mind map with others!</p>
                <div class="relative">
                    <input id="share-url" type="text" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700" readonly>
                    <button id="copy-link-btn" class="absolute right-1 top-1/2 -translate-y-1/2 p-2 bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    </button>
                </div>
                <p id="copy-feedback" class="text-sm text-green-600 dark:text-green-400 h-4 text-center"></p>
            </div>
        </div>
    </div>

    <div id="toolbar">
        <button id="menu-toggle-btn" title="Toggle Menu" class="p-3 rounded-full bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
        <div id="toolbar-tools">
            <button id="home-btn" title="Reset View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            </button>
            <button id="toggle-all-btn" title="Expand/Collapse All" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4h4m12 4V4h-4M4 16v4h4m12-4v4h-4" /></svg>
            </button>
            <button id="list-view-btn" title="List View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="prev-btn" title="Previous Topic (Left Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="next-btn" title="Next Topic (Right Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="share-btn" title="Share" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" /></svg>
            </button>
            <button id="theme-toggle" title="Toggle Dark Mode" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ========= DYNAMIC CONTENT SECTION START =========
            const ROOT_NODE_ID = 'engineering_data_analysis';

            const mindMapInfo = {
                engineering_data_analysis: {
                    title: "Engineering Data Analysis",
                    content: `<p>This course is designed for undergraduate engineering students with emphasis on problem solving related to societal issues that engineers and scientists are called upon to solve. It introduces different methods of data collection and the suitability of using a particular method for a given situation. The relationship of probability to statistics is also discussed, providing students with the tools they need to understand how "chance" plays a role in statistical analysis. Probability distributions of random variables and their uses are also considered, along with a discussion of linear functions of random variables within the context of their application to data analysis and inference. The course also includes estimation techniques for unknown parameters; and hypothesis testing used in making inferences from sample to population; inference for regression parameters and build models for estimating means and predicting future values of key variables under study. Finally, statistically based experimental design techniques and analysis of outcomes of experiments are discussed with the aid of statistical software.</p>
                             <h3>How to Use This Mind Map</h3>
                             <ul>
                                 <li><strong>Click Nodes:</strong> Click a category to expand/collapse. Click a concept for details or to open its link.</li>
                                 <li><strong>Pan & Zoom:</strong> Drag the background to pan. Use your mouse wheel to zoom.</li>
                                 <li><strong>Toolbar:</strong> Use the floating toolbar for more options:
                                     <ul>
                                         <li><strong>Reset View:</strong> Centers the map.</li>
                                         <li><strong>Expand/Collapse All:</strong> Toggles all categories.</li>
                                         <li><strong>List View:</strong> Switches to a text-based view.</li>
                                         <li><strong>Navigate:</strong> Use arrows to cycle through topics.</li>
                                         <li><strong>Share:</strong> Get a link to share the map.</li>
                                         <li><strong>Theme:</strong> Switch between light/dark modes.</li>
                                     </ul>
                                 </li>
                             </ul>`,
                    keywords: "engineering, data, analysis, statistics, probability"
                },
                course_information: {
                    title: "Course Information",
                    content: "<p>General information about the course structure, requirements, and outcomes.</p>",
                    keywords: "course, information, details, prerequisites, outcomes"
                },
                course_description_node: {
                    title: "Course Description",
                    content: "<p>This course is designed for undergraduate engineering students with emphasis on problem solving related to societal issues that engineers and scientists are called upon to solve. It introduces different methods of data collection, probability, statistical inference, regression, and experimental design techniques.</p>",
                    keywords: "description, overview, summary"
                },
                course_details: {
                    title: "Details",
                    content: "<ul><li><strong>Number of Units:</strong> 3 units lecture</li><li><strong>Contact Hours:</strong> 3 hours per week</li><li><strong>Prerequisites:</strong> Calculus 1</li><li><strong>Program Outcome/s Addressed:</strong> a-l, b-l, k-l</li></ul>",
                    keywords: "units, hours, prerequisites, outcomes"
                },
                course_outcomes: {
                    title: "Course Outcomes",
                    content: "<p>After completing this course, the student must be able to:</p><ul><li>Apply statistical methods in the analysis of data.</li><li>Design experiments involving several factors.</li></ul>",
                    keywords: "outcomes, learning, goals"
                },
                obtaining_data: {
                    title: "1. Obtaining Data",
                    content: "<p>Covers the fundamentals of data acquisition, including collection methods and the design of surveys and experiments.</p>",
                    keywords: "data collection, survey, experiment, design"
                },
                methods_of_data_collection: {
                    title: "1.1 Data Collection",
                    content: "<p>Introduces different methods of data collection and discusses the suitability of using a particular method for a given situation.</p>",
                    keywords: "methods, data collection"
                },
                planning_surveys: {
                    title: "1.2 Planning Surveys",
                    content: "<p>Focuses on the principles of planning and conducting effective surveys.</p>",
                    keywords: "survey, planning"
                },
                planning_experiments: {
                    title: "1.3 Planning Experiments",
                    content: "<p>Provides an introduction to planning and conducting experiments, a key component of the Design of Experiments (DOE).</p>",
                    keywords: "experiments, design of experiments, doe"
                },
                probability: {
                    title: "2. Probability",
                    content: "<p>Explores the foundational concepts of probability, which are essential for understanding statistical analysis.</p>",
                    keywords: "probability, chance, events"
                },
                sample_space_events: {
                    title: "2.1 Sample Space & Events",
                    content: "<p>Defines the sample space of an experiment and the relationships between different events.</p>",
k                   keywords: "sample space, events, outcomes"
                },
                counting_rules: {
                    title: "2.2 Counting Rules",
                    content: "<p>Introduces various counting rules and techniques that are useful in calculating probabilities.</p>",
                    keywords: "counting, permutations, combinations"
                },
                rules_of_probability: {
                    title: "2.3 Rules of Probability",
                    content: "<p>Covers the fundamental axioms and rules that govern probability theory.</p>",
                    keywords: "axioms, rules, probability theory"
                },
                discrete_probability_distributions: {
                    title: "3. Discrete Distributions",
                    content: "<p>Focuses on random variables that take on a countable number of values and their associated probability distributions.</p>",
                    keywords: "discrete, random variable, distribution, binomial, poisson"
                },
                random_variables_discrete: {
                    title: "3.1 Random Variables",
                    content: "<p>Introduces discrete random variables and their probability distributions.</p>",
                    keywords: "random variables, probability mass function"
                },
                cumulative_distribution_functions: {
                    title: "3.2 CDFs",
                    content: "<p>Discusses Cumulative Distribution Functions (CDFs) for discrete random variables, which describe the probability that a variable takes a value less than or equal to a certain value.</p>",
                    keywords: "cdf, cumulative distribution function"
                },
                expected_values_discrete: {
                    title: "3.3 Expected Values",
                    content: "<p>Covers the concept of expected value (or mean) for discrete random variables.</p>",
                    keywords: "expected value, mean, variance"
                },
                binomial_distribution: {
                    title: "3.4 Binomial Distribution",
                    content: "<p>Explores the Binomial distribution, used to model the number of successes in a fixed number of independent Bernoulli trials.</p>",
                    keywords: "binomial distribution, bernoulli trials"
                },
                poisson_distribution: {
                    title: "3.5 Poisson Distribution",
                    content: "<p>Covers the Poisson distribution, which models the number of events occurring in a fixed interval of time or space.</p>",
                    keywords: "poisson distribution, events, rate"
                },
                continuous_probability_distributions: {
                    title: "4. Continuous Distributions",
                    content: "<p>Focuses on random variables that can take any value within a given range and their probability distributions.</p>",
                    keywords: "continuous, random variable, distribution, normal, exponential"
                },
                continuous_random_variables: {
                    title: "4.1 Continuous Variables",
                    content: "<p>Introduces continuous random variables and their probability density functions (PDFs).</p>",
                    keywords: "continuous random variables, probability density function, pdf"
                },
                expected_values_continuous: {
                    title: "4.2 Expected Values",
                    content: "<p>Discusses the calculation of expected values for continuous random variables.</p>",
                    keywords: "expected value, mean, continuous"
                },
                normal_distribution: {
                    title: "4.3 Normal Distribution",
                    content: "<p>Covers the Normal (or Gaussian) distribution, one of the most important distributions in statistics.</p>",
                    keywords: "normal distribution, gaussian, bell curve"
                },
                normal_approximation: {
                    title: "4.4 Normal Approximation",
                    content: "<p>Explains how the Normal distribution can be used to approximate the Binomial and Poisson distributions under certain conditions.</p>",
                    keywords: "normal approximation, binomial, poisson"
                },
                exponential_distribution: {
                    title: "4.5 Exponential Distribution",
                    content: "<p>Covers the Exponential distribution, often used to model the time until an event occurs.</p>",
                    keywords: "exponential distribution, waiting time"
                },
                joint_probability_distributions: {
                    title: "5. Joint Distributions",
                    content: "<p>Explores how to describe the behavior of two or more random variables simultaneously.</p>",
                    keywords: "joint, marginal, conditional, probability, distribution"
                },
                two_or_more_rv: {
                    title: "5.1 Multiple Variables",
                    content: "<h3>Two or More Random Variables</h3><p>Examines probability distributions involving multiple variables.</p><ul><li><b>5.1.1. Joint Probability Distributions:</b> Defines distributions for two or more random variables considered together.</li><li><b>5.1.2. Marginal Probability Distribution:</b> The probability distribution of a subset of random variables.</li><li><b>5.1.3. Conditional Probability Distribution:</b> The probability distribution of a random variable when the value of another is known.</li><li><b>5.1.4. More than Two Random Variables:</b> Extends these concepts to higher dimensions.</li></ul>",
                    keywords: "joint, marginal, conditional, distribution"
                },
                linear_functions_rv: {
                    title: "5.2 Linear Functions",
                    content: "<p>Discusses the properties of linear combinations of random variables, such as the sum or difference of variables.</p>",
                    keywords: "linear functions, random variables, combination"
                },
                general_functions_rv: {
                    title: "5.3 General Functions",
                    content: "<p>Explores the distributions of general functions of random variables, beyond simple linear combinations.</p>",
                    keywords: "general functions, transformation"
                },
                estimation_and_sampling: {
                    title: "6. Estimation & Sampling",
                    content: "<p>Introduces the core concepts of using sample data to estimate population parameters.</p>",
                    keywords: "sampling, estimation, central limit theorem, estimator"
                },
                point_estimation: {
                    title: "6.1 Point Estimation",
                    content: "<p>Introduces the concept of using a single value, or point estimate, from sample data to estimate a population parameter.</p>",
                    keywords: "point estimation, estimate"
                },
                central_limit_theorem: {
                    title: "6.2 Central Limit Theorem",
                    content: "<p>Covers the Central Limit Theorem (CLT), a fundamental theorem stating that the distribution of sample means approximates a normal distribution as the sample size gets larger.</p>",
                    keywords: "central limit theorem, clt, sampling distribution"
                },
                concepts_point_estimation: {
                    title: "6.3 Estimation Concepts",
                    content: "<h3>General Concepts of Point Estimation</h3><p>Describes the properties used to evaluate the quality of point estimators.</p><ul><li><b>6.3.1. Unbiased Estimator:</b> An estimator whose expected value is equal to the true population parameter.</li><li><b>6.3.2. Variance of a Point Estimator:</b> Measures the precision of the estimator.</li><li><b>6.3.3. Standard Error:</b> The standard deviation of the estimator, indicating its variability.</li><li><b>6.3.4. Mean Squared Error (MSE):</b> A measure of the overall quality of an estimator, combining variance and bias.</li></ul>",
                    keywords: "unbiased, variance, standard error, mse"
                },
                statistical_intervals: {
                    title: "7. Statistical Intervals",
                    content: "<p>Moves beyond point estimates to provide a range of plausible values for a population parameter.</p>",
                    keywords: "confidence interval, prediction, tolerance"
                },
                confidence_intervals_single: {
                    title: "7.1 C.I. (Single Sample)",
                    content: "<p>Focuses on constructing confidence intervals for a population parameter based on a single sample.</p>",
                    keywords: "confidence interval, single sample, mean, proportion"
                },
                confidence_intervals_multiple: {
                    title: "7.2 C.I. (Multiple Samples)",
                    content: "<p>Explains how to construct confidence intervals for the difference between parameters from two or more samples.</p>",
                    keywords: "confidence interval, multiple samples, difference"
                },
                prediction_intervals: {
                    title: "7.3 Prediction Intervals",
                    content: "<p>Covers prediction intervals, which provide a range for a future observation, rather than a population parameter.</p>",
                    keywords: "prediction interval, future observation"
                },
                tolerance_intervals: {
                    title: "7.4 Tolerance Intervals",
                    content: "<p>Discusses tolerance intervals, which are ranges expected to contain a specified proportion of a population.</p>",
                    keywords: "tolerance interval, population proportion"
                },
                hypothesis_testing_single_sample: {
                    title: "8. Hypothesis Testing (1 Sample)",
                    content: "<p>Introduces the formal procedures for making statistical decisions using experimental data from a single sample.</p>",
                    keywords: "hypothesis test, single sample, p-value"
                },
                hypothesis_testing_concepts: {
                    title: "8.1 Testing Concepts",
                    content: "<h3>Hypothesis Testing</h3><p>Covers the foundational principles of hypothesis testing.</p><ul><li><b>8.1.1. One-sided and Two-sided Hypothesis:</b> Differentiating between directional and non-directional tests.</li><li><b>8.1.2. P-value in Hypothesis Tests:</b> Understanding the p-value as a measure of evidence against the null hypothesis.</li><li><b>8.1.3. General Procedure:</b> Outlines the step-by-step process for conducting a hypothesis test.</li></ul>",
                    keywords: "one-sided, two-sided, p-value, procedure"
                },
                test_on_the_mean_variance_known: {
                    title: "8.2 Test on Mean (σ² known)",
                    content: "<p>Describes the procedure for testing hypotheses about a population mean when the population variance is known (Z-test).</p>",
                    keywords: "z-test, mean, variance known"
                },
                test_on_the_mean_variance_unknown: {
                    title: "8.3 Test on Mean (σ² unknown)",
                    content: "<p>Describes the procedure for testing hypotheses about a population mean when the population variance is unknown (t-test).</p>",
                    keywords: "t-test, mean, variance unknown"
                },
                test_on_variance: {
                    title: "8.4 Test on Variance",
                    content: "<p>Covers the methods for testing hypotheses about the variance or standard deviation of a normal population (Chi-squared test).</p>",
                    keywords: "variance, standard deviation, chi-squared test"
                },
                test_on_population_proportion: {
                    title: "8.5 Test on Proportion",
                    content: "<p>Details the procedure for testing hypotheses about a population proportion.</p>",
                    keywords: "proportion, population proportion test"
                },
                statistical_inference_two_samples: {
                    title: "9. Inference (2 Samples)",
                    content: "<p>Extends hypothesis testing and confidence intervals to compare parameters from two different populations.</p>",
                    keywords: "two sample, inference, difference, means, proportions"
                },
                inference_on_difference_means_known: {
                    title: "9.1 Diff in Means (σ² Known)",
                    content: "<p>Covers inference (tests and confidence intervals) on the difference in means of two normal distributions when variances are known.</p>",
                    keywords: "difference in means, variance known"
                },
                inference_on_difference_means_unknown: {
                    title: "9.2 Diff in Means (σ² Unknown)",
                    content: "<p>Covers inference on the difference in means of two normal distributions when variances are unknown (two-sample t-test).</p>",
                    keywords: "difference in means, variance unknown, two-sample t-test"
                },
                inference_on_variances: {
                    title: "9.3 Inference on Variances",
                    content: "<p>Details the procedures for making inferences about the variances of two normal distributions (F-test).</p>",
                    keywords: "inference, variance, f-test"
                },
                inference_on_proportions: {
                    title: "9.4 Inference on Proportions",
                    content: "<p>Explains how to make inferences about the difference between two population proportions.</p>",
                    keywords: "inference, two proportions"
                },
                simple_linear_regression: {
                    title: "10. Simple Linear Regression",
                    content: "<p>Introduces techniques for modeling the linear relationship between a dependent variable and a single independent variable.</p>",
                    keywords: "regression, correlation, linear model, least squares"
                },
                empirical_models: {
                    title: "10.1 Empirical Models",
                    content: "<p>Introduces the concept of empirical models, which are based on observed data rather than theoretical principles.</p>",
                    keywords: "empirical models, data-driven"
                },
                least_squares: {
                    title: "10.2 Least-Squares",
                    content: "<p>Details the method of least squares for fitting a line to data, which minimizes the sum of squared residuals.</p>",
                    keywords: "least squares, regression line"
                },
                correlation: {
                    title: "10.3/10.7 Correlation",
                    content: "<p>Discusses correlation as a measure of the strength and direction of the linear relationship between two variables.</p>",
                    keywords: "correlation, strength, linear relation"
                },
                slr_hypothesis_tests: {
                    title: "10.4 SLR Hypothesis Tests",
                    content: "<h3>Hypothesis Tests in Simple Linear Regression</h3><p>Covers methods for testing the significance of the regression relationship.</p><ul><li><b>10.4.1. Use of t-tests:</b> Testing hypotheses about the slope and intercept of the regression line.</li><li><b>10.4.2. Analysis of Variance (ANOVA):</b> Using ANOVA to test the overall significance of the regression model.</li></ul>",
                    keywords: "t-test, anova, significance of regression"
                },
                slr_prediction: {
                    title: "10.5 Prediction",
                    content: "<p>Explains how to use a fitted regression model to predict new observations.</p>",
                    keywords: "prediction, new observations"
                },
                slr_model_adequacy: {
                    title: "10.6 Model Adequacy",
                    content: "<h3>Adequacy of the Regression Model</h3><p>Presents methods for checking if the regression model is appropriate for the data.</p><ul><li><b>10.6.1. Residual Analysis:</b> Analyzing the differences between observed and predicted values to check assumptions.</li><li><b>10.6.2. Coefficient of Determination ($R^2$):</b> A measure of how well the model explains the variability of the dependent variable.</li></ul>",
                    keywords: "residual analysis, coefficient of determination, r-squared"
                },
                multiple_linear_regression: {
                    title: "11. Multiple Linear Regression",
                    content: "<p>Extends simple linear regression to model the relationship between a dependent variable and two or more independent variables.</p>",
                    keywords: "multiple regression, mlr, model"
                },
                mlr_model: {
                    title: "11.1 MLR Model",
                    content: "<p>Introduces the multiple linear regression model, including its assumptions and matrix notation.</p>",
                    keywords: "multiple linear regression model"
                },
                mlr_hypothesis_tests: {
                    title: "11.2 MLR Hypothesis Tests",
                    content: "<p>Covers hypothesis testing in multiple regression, including tests for the overall model significance (F-test) and individual coefficients (t-tests).</p>",
                    keywords: "hypothesis test, f-test, t-test"
                },
                mlr_prediction: {
                    title: "11.3 MLR Prediction",
                    content: "<p>Explains how to use a fitted multiple regression model for predicting new observations.</p>",
                    keywords: "prediction, multiple regression"
                },
                mlr_model_adequacy: {
                    title: "11.4 MLR Model Adequacy",
                    content: "<p>Discusses methods for checking the adequacy of a multiple regression model, including residual analysis and other diagnostics.</p>",
                    keywords: "model adequacy, residual analysis"
                },
                design_of_experiments_single: {
                    title: "12. Single-Factor Experiments",
                    content: "<p>Focuses on designing and analyzing experiments where the effect of a single factor is being investigated.</p>",
                    keywords: "doe, anova, single factor, random effects, block design"
                },
                completely_randomized_design: {
                    title: "12.1 Randomized Experiments",
                    content: "<h3>Completely Randomized Single Factor Experiments</h3><ul><li><b>12.1.1. Analysis of Variance (ANOVA):</b> Using ANOVA to compare the means of multiple groups.</li><li><b>12.1.2. Multiple Comparisons:</b> Post-hoc tests (e.g., Tukey's test) to determine which specific means are different.</li><li><b>12.1.3. Residual Analysis and Model Checking:</b> Verifying the assumptions of the ANOVA model.</li><li><b>12.1.4. Determining Sample Size:</b> Methods for calculating the required sample size for an experiment.</li></ul>",
                    keywords: "anova, multiple comparisons, residual analysis, sample size"
                },
                random_effects_model: {
                    title: "12.2 Random-Effects Model",
                    content: "<h3>The Random-Effects Model</h3><ul><li><b>12.2.1. Fixed versus Random Factors:</b> Differentiating between fixed factors (specific levels of interest) and random factors (a random sample of levels).</li><li><b>12.2.2. ANOVA and Variance Components:</b> Estimating the components of variance in a random-effects model.</li></ul>",
                    keywords: "random effects, fixed effects, variance components"
                },
                randomized_complete_block_design: {
                    title: "12.3 Randomized Block Design",
                    content: "<h3>Randomized Complete Block Design (RCBD)</h3><p>An experimental design used to reduce variability by blocking experimental units into homogeneous groups.</p><ul><li><b>12.3.1. Design and Statistical Analysis:</b> The structure and analysis of RCBD.</li><li><b>12.3.2. Multiple Comparisons:</b> Performing comparisons within a block design.</li><li><b>12.3.3. Residual Analysis and Model Checking:</b> Validating the model for an RCBD.</li></ul>",
                    keywords: "rcbd, blocking, statistical analysis"
                },
                design_of_experiments_multiple: {
                    title: "13. Multi-Factor Experiments",
                    content: "<p>Covers the design and analysis of experiments where the effects of multiple factors are studied simultaneously.</p>",
                    keywords: "factorial, 2k design, blocking, confounding, response surface"
                },
                factorial_experiments: {
                    title: "13.1 Factorial Experiments",
                    content: "<p>Introduces factorial experiments, where all possible combinations of the levels of the factors are investigated.</p>",
                    keywords: "factorial experiments, interactions"
                },
                two_factor_experiments: {
                    title: "13.2 Two-Factor Experiments",
                    content: "<h3>Two-Factor Factorial Experiments</h3><ul><li><b>13.2.1. Statistical Analysis of the Fixed-Effects Model:</b> Analyzing the main effects and interaction effect of two factors.</li><li><b>13.2.2. Model Adequacy Checking:</b> Checking assumptions for the two-factor model.</li></ul>",
                    keywords: "two-factor, fixed-effects, interaction"
                },
                two_k_factorial_design: {
                    title: "13.3 $2^k$ Factorial Design",
                    content: "<h3>$2^k$ Factorial Design</h3><p>A special type of factorial design where 'k' factors are studied, each at two levels (high and low).</p><ul><li><b>13.3.1. Single Replicate:</b> Analysis when there is only one observation per treatment combination.</li><li><b>13.3.2. Addition of Center Points:</b> Adding points at the center of the design to check for curvature.</li></ul>",
                    keywords: "2k design, factorial, center points"
                },
                blocking_and_confounding: {
                    title: "13.4 Blocking & Confounding",
                    content: "<p>Discusses techniques for running large factorial designs in smaller blocks, where some effects are intentionally confounded with block effects.</p>",
                    keywords: "blocking, confounding, 2k design"
                },
                fractional_replication: {
                    title: "13.5 Fractional Replication",
                    content: "<p>Introduces fractional factorial designs, which use only a fraction of the runs of a full factorial design, allowing for efficient screening of many factors.</p>",
                    keywords: "fractional replication, 2k design, screening"
                },
                response_surface_methods: {
                    title: "13.6 Response Surface",
                    content: "<p>Covers Response Surface Methodology (RSM), a collection of techniques for optimizing processes by modeling the relationship between factors and a response variable.</p>",
                    keywords: "response surface methodology, rsm, optimization"
                }
            };

            const structure = {
                course_information: ['course_description_node', 'course_details', 'course_outcomes'],
                obtaining_data: ['methods_of_data_collection', 'planning_surveys', 'planning_experiments'],
                probability: ['sample_space_events', 'counting_rules', 'rules_of_probability'],
                discrete_probability_distributions: ['random_variables_discrete', 'cumulative_distribution_functions', 'expected_values_discrete', 'binomial_distribution', 'poisson_distribution'],
                continuous_probability_distributions: ['continuous_random_variables', 'expected_values_continuous', 'normal_distribution', 'normal_approximation', 'exponential_distribution'],
                joint_probability_distributions: ['two_or_more_rv', 'linear_functions_rv', 'general_functions_rv'],
                estimation_and_sampling: ['point_estimation', 'central_limit_theorem', 'concepts_point_estimation'],
                statistical_intervals: ['confidence_intervals_single', 'confidence_intervals_multiple', 'prediction_intervals', 'tolerance_intervals'],
                hypothesis_testing_single_sample: ['hypothesis_testing_concepts', 'test_on_the_mean_variance_known', 'test_on_the_mean_variance_unknown', 'test_on_variance', 'test_on_population_proportion'],
                statistical_inference_two_samples: ['inference_on_difference_means_known', 'inference_on_difference_means_unknown', 'inference_on_variances', 'inference_on_proportions'],
                simple_linear_regression: ['empirical_models', 'least_squares', 'correlation', 'slr_hypothesis_tests', 'slr_prediction', 'slr_model_adequacy'],
                multiple_linear_regression: ['mlr_model', 'mlr_hypothesis_tests', 'mlr_prediction', 'mlr_model_adequacy'],
                design_of_experiments_single: ['completely_randomized_design', 'random_effects_model', 'randomized_complete_block_design'],
                design_of_experiments_multiple: ['factorial_experiments', 'two_factor_experiments', 'two_k_factorial_design', 'blocking_and_confounding', 'fractional_replication', 'response_surface_methods']
            };
            // ========= DYNAMIC CONTENT SECTION END =========


            // --- CORE LOGIC (DO NOT EDIT) ---
            const hierarchyRoot = { id: ROOT_NODE_ID, level: 0, children: [] };
            for (const catId in structure) {
                if (mindMapInfo[catId]) {
                    const categoryNode = { id: catId, level: 1, _children: [] };
                    hierarchyRoot.children.push(categoryNode);
                    if (structure[catId] && structure[catId].length > 0) {
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) {
                                categoryNode._children.push({ id: topicId, level: 2 });
                            }
                        });
                    }
                }
            }
            
            const mindMapContainer = document.getElementById('mind-map-container');
            const listViewContainer = document.getElementById('list-view-container');
            const infoModal = document.getElementById('info-modal');
            const shareModal = document.getElementById('share-modal');
            const themeToggleButton = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const menuToggleButton = document.getElementById('menu-toggle-btn');
            const toolbar = document.getElementById('toolbar');
            
            let simulation, svg, g, linkGroup, nodeGroup, link, node, zoom;
            let sequentialNavigableNodes = [];
            let highlightedNodeIndex = -1;

            function getVisibleNodesAndLinks(root) {
                const visibleNodes = [], visibleLinks = [];
                function recurse(node) {
                    if (!node) return;
                    visibleNodes.push(node);
                    if (node.children) {
                        node.children.forEach(child => {
                            visibleLinks.push({ source: node, target: child });
                            recurse(child);
                        });
                    }
                }
                recurse(root);
                return { nodes: visibleNodes, links: visibleLinks };
            }

            function updateGraph(callback) {
                const { nodes: currentNodes, links: currentLinks } = getVisibleNodesAndLinks(hierarchyRoot);
                const tempSvg = d3.select(document.body).append("svg").attr("class", "absolute -left-full");
                currentNodes.forEach(n => {
                    const textEl = tempSvg.append("text")
                        .attr("class", `node level-${n.level}`)
                        .style("font-size", n.level === 0 ? "16px" : n.level === 1 ? "14px" : "12px")
                        .style("font-weight", n.level < 2 ? "700" : "500")
                        .text(mindMapInfo[n.id].title);
                    const bbox = textEl.node().getBBox();
                    n.width = bbox.width + (n.level === 1 ? 40 : 30);
                    n.height = bbox.height + 20;
                });
                tempSvg.remove();

                node = nodeGroup.selectAll(".node").data(currentNodes, d => d.id)
                    .join(
                        enter => {
                            const nodeEnter = enter.append("g")
                                .attr("class", d => `node level-${d.level}`)
                                .call(drag(simulation))
                                .on("click", handleNodeClick);
                            nodeEnter.append("rect");
                            nodeEnter.append("text");
                            return nodeEnter;
                        },
                        update => update,
                        exit => exit.transition().duration(300).attr("transform", "scale(0)").remove()
                    );
                
                node.classed("collapsed", d => d._children && !d.children);
                node.select("rect").transition().duration(300)
                    .attr("width", d => d.width).attr("height", d => d.height)
                    .attr("x", d => -d.width / 2).attr("y", d => -d.height / 2);
                node.select("text").text(d => mindMapInfo[d.id].title);

                link = linkGroup.selectAll(".link").data(currentLinks, d => `${d.source.id}-${d.target.id}`)
                    .join(
                        enter => enter.append("line").attr("class", "link").attr("stroke-opacity", 0),
                        update => update,
                        exit => exit.transition().duration(300).attr("stroke-opacity", 0).remove()
                    );
                link.transition().duration(300).attr("stroke-opacity", 0.7);

                simulation.nodes(currentNodes);
                simulation.force("link").links(currentLinks);
                simulation.alpha(0.8).restart();

                if (callback) {
                    const cb = () => {
                        callback();
                        simulation.on('end.callback', null);
                    };
                    simulation.on('end.callback', cb);
                }
            }

            function openInfoModal(nodeId) {
                const data = mindMapInfo[nodeId];
                if (data && data.content) {
                    document.getElementById('modal-title').innerHTML = data.title;
                    const modalBody = document.getElementById('modal-body');
                    modalBody.innerHTML = data.content;
                    if (window.renderMathInElement) {
                        window.renderMathInElement(modalBody, {
                            delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false} ],
                            throwOnError: false
                        });
                    }
                    infoModal.classList.add('active');
                }
            }

            function handleNodeClick(event, d) {
                if (event.defaultPrevented) return;
                const nodeInfo = mindMapInfo[d.id];
                highlightNode(d.id, false);

                if (nodeInfo.url) {
                    window.open(nodeInfo.url, '_blank');
                    highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === d.id);
                    return;
                }

                if (d.id === ROOT_NODE_ID) {
                    toggleAllNodes();
                } else if (d._children && d._children.length > 0) {
                    d.children = d.children ? null : d._children;
                    updateGraph();
                } else if (nodeInfo.content) {
                    openInfoModal(d.id);
                    highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === d.id);
                }
            }

            function initializeGraph() {
                sequentialNavigableNodes = [];
                Object.values(structure).forEach(chapter => {
                    chapter.forEach(topicId => {
                        const nodeData = hierarchyRoot.children.flatMap(c => c._children || []).find(n => n.id === topicId);
                        if(nodeData) sequentialNavigableNodes.push(nodeData);
                    });
                });

                if (listViewContainer.classList.contains('hidden')) {
                    const width = mindMapContainer.clientWidth;
                    const height = mindMapContainer.clientHeight;
                    d3.select(mindMapContainer).select("svg").remove();
                    svg = d3.select(mindMapContainer).append("svg").attr("viewBox", [0, 0, width, height]);
                    g = svg.append("g");
                    linkGroup = g.append("g").attr("class", "links");
                    nodeGroup = g.append("g").attr("class", "nodes");
                    simulation = d3.forceSimulation()
                        .force("link", d3.forceLink().id(d => d.id).distance(d => (d.source.level === 0 ? 200 : 120)).strength(0.9))
                        .force("charge", d3.forceManyBody().strength(-800))
                        .force("center", d3.forceCenter(width / 2, height / 2))
                        .force("collide", d3.forceCollide().radius(d => d.width / 2 + 15).strength(1))
                        .on("tick", () => {
                            if(link) link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                            if(node) node.attr("transform", d => `translate(${d.x},${d.y})`);
                        });
                    zoom = d3.zoom().scaleExtent([0.1, 3]).on("zoom", e => g.attr("transform", e.transform));
                    svg.call(zoom);
                    hierarchyRoot.children.forEach(child => child.children = null);
                    updateGraph();
                }
            }
            
            function drag(simulation) {
                function dragstarted(event, d) { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; }
                function dragged(event, d) { d.fx = event.x; d.fy = event.y; }
                function dragended(event, d) { if (!event.active) simulation.alphaTarget(0); if (d.id !== ROOT_NODE_ID) { d.fx = null; d.fy = null; } }
                return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
            }

            function resetView() { if (svg && zoom) { svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity); } }
            function toggleAllNodes() {
                const shouldCollapseAll = hierarchyRoot.children.some(c => c.children);
                hierarchyRoot.children.forEach(child => { child.children = shouldCollapseAll ? null : (child._children || null); });
                updateGraph();
            }

            function generateListView() {
                let html = `<h1>${mindMapInfo[ROOT_NODE_ID].title}</h1>`;
                for (const catId in structure) {
                    if (mindMapInfo[catId]) {
                        html += `<h2 data-id="${catId}">${mindMapInfo[catId].title}</h2><ul>`;
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) { html += `<li data-id="${topicId}">${mindMapInfo[topicId].title}</li>`; }
                        });
                        html += '</ul>';
                    }
                }
                listViewContainer.innerHTML = html;
                listViewContainer.querySelectorAll('li, h2').forEach(item => {
                    item.addEventListener('click', () => {
                        const info = mindMapInfo[item.dataset.id];
                        if (info.url) { window.open(info.url, '_blank'); } 
                        else if (info.content) { openInfoModal(item.dataset.id); }
                    });
                });
            }

            function toggleListView() {
                mindMapContainer.classList.toggle('hidden');
                listViewContainer.classList.toggle('hidden');
                if (!listViewContainer.classList.contains('hidden') && listViewContainer.innerHTML === '') { generateListView(); }
            }
            
            function highlightNode(nodeId, doPan = true) {
                if (!node) return;
                node.classed("highlight", d => d.id === nodeId);
                if (doPan) {
                    const targetNode = simulation.nodes().find(n => n.id === nodeId);
                    if (targetNode && svg && zoom) {
                        const width = mindMapContainer.clientWidth;
                        const height = mindMapContainer.clientHeight;
                        const t = d3.zoomTransform(svg.node());
                        const transform = d3.zoomIdentity.translate(width / 2 - targetNode.x * t.k, height / 2 - targetNode.y * t.k).scale(t.k);
                        svg.transition().duration(500).call(zoom.transform, transform);
                    }
                }
            }
            
            function navigate(direction) {
                if (sequentialNavigableNodes.length === 0 || listViewContainer.classList.contains('hidden') === false) return;
                highlightedNodeIndex = (highlightedNodeIndex + direction + sequentialNavigableNodes.length) % sequentialNavigableNodes.length;
                const nextNode = sequentialNavigableNodes[highlightedNodeIndex];
                const parentNode = hierarchyRoot.children.find(c => c._children.some(child => child.id === nextNode.id));
                let needsUpdate = false;
                if (parentNode && !parentNode.children) {
                    parentNode.children = parentNode._children;
                    needsUpdate = true;
                }
                if (needsUpdate) { updateGraph(() => { highlightNode(nextNode.id); }); } 
                else { highlightNode(nextNode.id); }
            }

            // --- EVENT LISTENERS ---
            document.getElementById('close-modal-info').addEventListener('click', () => infoModal.classList.remove('active'));
            infoModal.addEventListener('click', (e) => e.target === infoModal && infoModal.classList.remove('active'));
            
            themeToggleButton.addEventListener('click', () => {
                const isDark = document.body.classList.toggle('dark');
                themeIconLight.classList.toggle('hidden', isDark);
                themeIconDark.classList.toggle('hidden', !isDark);
            });

            document.getElementById('share-btn').addEventListener('click', () => {
                document.getElementById('share-url').value = window.location.href;
                shareModal.classList.add('active');
            });
            document.getElementById('close-modal-share').addEventListener('click', () => shareModal.classList.remove('active'));
            shareModal.addEventListener('click', (e) => e.target === shareModal && shareModal.classList.remove('active'));
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                const urlInput = document.getElementById('share-url');
                navigator.clipboard.writeText(urlInput.value).then(() => {
                    const feedback = document.getElementById('copy-feedback');
                    feedback.textContent = 'Link copied!';
                    setTimeout(() => feedback.textContent = '', 2000);
                });
            });

            window.addEventListener('resize', initializeGraph);
            menuToggleButton.addEventListener('click', () => toolbar.classList.toggle('expanded'));
            document.getElementById('home-btn').addEventListener('click', resetView);
            document.getElementById('toggle-all-btn').addEventListener('click', toggleAllNodes);
            document.getElementById('list-view-btn').addEventListener('click', toggleListView);
            document.getElementById('prev-btn').addEventListener('click', () => navigate(-1));
            document.getElementById('next-btn').addEventListener('click', () => navigate(1));
            
            window.addEventListener('keydown', (e) => {
                if (document.activeElement.tagName === 'INPUT' || infoModal.classList.contains('active') || shareModal.classList.contains('active')) return;
                if (e.key === 'ArrowRight') navigate(1);
                else if (e.key === 'ArrowLeft') navigate(-1);
            });

            initializeGraph();
        });
    </script>
</body>
</html>