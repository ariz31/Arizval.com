<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Interactive Mind Map: College Algebra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- KaTeX for LaTeX Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMckDMOe6bvJOiFnO4IMUYLz3G92BIUKEp5nA7C8MFFKSSJTI" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-light: #f8fafc; --bg-dark: #0b1120;
            --node-bg-light: #ffffff; --node-bg-dark: #1e293b;
            --text-light: #1e293b; --text-dark: #e2e8f0;
            --border-light: #cbd5e1; --border-dark: #475569;
            --link-light: #94a3b8; --link-dark: #64748b;
            --primary-light: #3b82f6; --primary-dark: #60a5fa;
            --primary-text-light: #ffffff; --primary-text-dark: #0b1120;
            --highlight-border-light: #ef4444; /* Red-500 */
            --highlight-border-dark: #f87171; /* Red-400 */
            
            --cat-bg-expanded-light: #e0e7ff; --cat-border-expanded-light: #a5b4fc; --cat-text-expanded-light: #3730a3;
            --cat-bg-collapsed-light: #e5e7eb; --cat-border-collapsed-light: #9ca3af; --cat-text-collapsed-light: #4b5563;
            --cat-bg-expanded-dark: #312e81; --cat-border-expanded-dark: #818cf8; --cat-text-expanded-dark: #e0e7ff;
            --cat-bg-collapsed-dark: #374151; --cat-border-collapsed-dark: #6b7280; --cat-text-collapsed-dark: #d1d5db;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Inter', sans-serif;
            background-color: var(--bg-light); transition: background-color 0.3s ease;
        }
        body.dark { background-color: var(--bg-dark); }
        #mind-map-container, #list-view-container { width: 100%; height: 100%; position: relative; box-sizing: border-box; }
        #mind-map-container { cursor: grab; }
        #mind-map-container:active { cursor: grabbing; }

        .node { cursor: pointer; }
        .node rect {
            stroke-width: 2.5px; rx: 8; ry: 8;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
            transition: fill 0.3s ease, stroke 0.3s ease, transform 0.2s ease, stroke-width 0.2s ease;
        }
        .node:hover rect { transform: scale(1.05); }
        .node text { pointer-events: none; text-anchor: middle; dominant-baseline: central; font-weight: 500; transition: fill 0.3s ease; }
        .link { stroke-opacity: 0.7; transition: stroke 0.3s ease; }
        .katex { font-size: 1.1em; }

        .node.level-0 rect { fill: var(--primary-light); stroke: var(--primary-light); }
        .node.level-0 text { fill: var(--primary-text-light); font-size: 16px; font-weight: 700; }
        .node.level-1 rect { fill: var(--cat-bg-expanded-light); stroke: var(--cat-border-expanded-light); }
        .node.level-1 text { fill: var(--cat-text-expanded-light); font-size: 14px; font-weight: 600; }
        .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-light); stroke: var(--cat-border-collapsed-light); }
        .node.level-1.collapsed text { fill: var(--cat-text-collapsed-light); }
        .node.level-2 rect { fill: var(--node-bg-light); stroke: var(--border-light); }
        .node.level-2 text { fill: var(--text-light); font-size: 12px; }
        .link { stroke: var(--link-light); }
        
        body.dark .node.level-0 rect { fill: var(--primary-dark); stroke: var(--primary-dark); }
        body.dark .node.level-0 text { fill: var(--primary-text-dark); }
        body.dark .node.level-1 rect { fill: var(--cat-bg-expanded-dark); stroke: var(--cat-border-expanded-dark); }
        body.dark .node.level-1 text { fill: var(--cat-text-expanded-dark); }
        body.dark .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-dark); stroke: var(--cat-border-collapsed-dark); }
        body.dark .node.level-1.collapsed text { fill: var(--cat-text-collapsed-dark); }
        body.dark .node.level-2 rect { fill: var(--node-bg-dark); stroke: var(--border-dark); }
        body.dark .node.level-2 text { fill: var(--text-dark); }
        body.dark .link { stroke: var(--link-dark); }

        .node.highlight rect { stroke: var(--highlight-border-light); stroke-width: 4px; }
        body.dark .node.highlight rect { stroke: var(--highlight-border-dark); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--node-bg-light); color: var(--text-light); padding: 1.5rem; border-radius: 0.75rem; max-width: 90%; width: 500px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease; }
        body.dark .modal-content { background: var(--node-bg-dark); color: var(--text-dark); }
        .modal-content h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark .modal-content h2 { color: var(--primary-dark); }
        .modal-content h3 { font-size: 1.15rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-light); }
        body.dark .modal-content h3 { color: var(--primary-dark); }
        .modal-content code { background-color: #e2e8f0; color: #1e293b; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; }
        body.dark .modal-content code { background-color: #475569; color: #e2e8f0; }

        /* Toolbar Styles */
        #toolbar {
            position: fixed;
            z-index: 500;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        #toolbar.expanded {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(200, 200, 200, 0.5);
            border-radius: 9999px;
            padding: 0.5rem;
        }
        body.dark #toolbar.expanded {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(71, 85, 105, 0.5);
        }

        #toolbar-tools {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.25, 1, 0.5, 1), padding 0.5s ease;
        }

        #toolbar.expanded #toolbar-tools {
            max-height: 500px;
        }

        .toolbar-divider {
            width: 80%;
            height: 1px;
            margin: 0.25rem auto;
            background-color: #e2e8f0;
        }
        body.dark .toolbar-divider {
            background-color: #475569;
        }

        #list-view-container {
            padding: 2rem;
            overflow-y: auto;
            background-color: var(--bg-light);
            color: var(--text-light);
            box-sizing: border-box;
            height: 100%;
        }
        body.dark #list-view-container { background-color: var(--bg-dark); color: var(--text-dark); }
        #list-view-container h1 { font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark #list-view-container h1 { color: var(--primary-dark); }
        #list-view-container h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 2px solid var(--border-light); padding-bottom: 0.5rem; }
        body.dark #list-view-container h2 { border-bottom-color: var(--border-dark); }
        #list-view-container ul { list-style: none; padding-left: 1rem; }
        #list-view-container li {
            padding: 0.5rem; margin: 0.25rem 0; border-radius: 0.5rem;
            cursor: pointer; transition: background-color 0.2s;
        }
        #list-view-container li:hover { background-color: rgba(0,0,0,0.05); }
        body.dark #list-view-container li:hover { background-color: rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div id="mind-map-container"></div>
    <div id="list-view-container" class="hidden"></div>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modal-title"></h2>
                <button id="close-modal-info" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <!-- Share Modal -->
    <div id="share-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">Share Mind Map</h2>
                <button id="close-modal-share" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">&times;</button>
            </div>
            <div class="space-y-4">
                <p class="text-sm text-gray-600 dark:text-gray-400">Share this interactive mind map with others!</p>
                <div class="flex justify-around space-x-2">
                    <a id="share-facebook" href="#" target="_blank" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" title="Share on Facebook">
                        <svg class="h-8 w-8 text-[#1877F2]" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3l-.5 3h-2.5v6.8c4.56-.93 8-4.96 8-9.8z"/></svg>
                    </a>
                    <a id="share-twitter" href="#" target="_blank" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" title="Share on Twitter">
                        <svg class="h-8 w-8 text-[#1DA1F2]" fill="currentColor" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.67.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.27 0 .34.04.67.11.98-3.56-.18-6.72-1.88-8.84-4.48-.37.63-.58 1.37-.58 2.15 0 1.48.75 2.79 1.9 3.55-.7-.02-1.37-.22-1.95-.5v.03c0 2.07 1.48 3.8 3.44 4.2-.36.1-.74.15-1.14.15-.28 0-.55-.03-.81-.08.55 1.7 2.14 2.93 4.03 2.96-1.46 1.14-3.3 1.82-5.3 1.82-.34 0-.68-.02-1.02-.06 1.9 1.22 4.16 1.92 6.56 1.92 7.88 0 12.2-6.54 12.2-12.2 0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg>
                    </a>
                    <a id="share-linkedin" href="#" target="_blank" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" title="Share on LinkedIn">
                        <svg class="h-8 w-8 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24"><path d="M21 3H3C1.9 3 1 3.9 1 5v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM8 18H5V9h3v9zm-1.5-10.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM19 18h-3v-4.74c0-1.42-.6-2.26-1.69-2.26-1.19 0-1.81.8-1.81 2.26V18h-3V9h3v1.34c.4-.72 1.2-1.34 2.69-1.34 2.81 0 3.31 1.66 3.31 4.76V18z"/></svg>
                    </a>
                </div>
                <div class="relative">
                    <input id="share-url" type="text" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700" readonly>
                    <button id="copy-link-btn" class="absolute right-1 top-1/2 -translate-y-1/2 p-2 bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    </button>
                </div>
                <p id="copy-feedback" class="text-sm text-green-600 dark:text-green-400 h-4 text-center"></p>
            </div>
        </div>
    </div>


    <!-- Toolbar -->
    <div id="toolbar">
        <button id="menu-toggle-btn" title="Toggle Menu" class="p-3 rounded-full bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
        <div id="toolbar-tools">
            <button id="home-btn" title="Reset View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            </button>
            <button id="toggle-all-btn" title="Toggle All" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" /></svg>
            </button>
            <button id="list-view-btn" title="List View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="prev-btn" title="Previous Node (Left Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="next-btn" title="Next Node (Right Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="share-btn" title="Share" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" /></svg>
            </button>
            <button id="theme-toggle" title="Toggle Dark Mode" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ========= DYNAMIC CONTENT SECTION START =========
            const ROOT_NODE_ID = 'college_algebra';

            const mindMapInfo = {
                college_algebra: { title: "College Algebra", content: "<p>An interactive mind map covering the core concepts of College Algebra.</p><h3>How to Use:</h3><ul><li>Click a chapter to expand/collapse.</li><li>Click a section to open the corresponding learning materials in a new tab.</li><li>Use the toolbar to navigate, search, and switch views.</li></ul>", keywords: "math, study, guide, map" },

                // Chapter 1: Prerequisites
                prerequisites: { title: "1. Prerequisites", content: "Foundational concepts for the study of algebra.", keywords: "basics, fundamentals, foundations, review" },
                real_numbers: { title: "1.1 Real Numbers", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/01-real-numbers.html", keywords: "integers, rational, irrational, number line, properties" },
                exponents_sci_notation: { title: "1.2 Exponents & Sci Notation", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/02-exponents-and-sci-notation.html", keywords: "powers, scientific notation, engineering notation" },
                radicals_rational_exponents: { title: "1.3 Radicals & Rational Exponents", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/03-radicals-rational-exponents.html", keywords: "roots, square root, cube root, fractional exponents" },
                polynomials_prereq: { title: "1.4 Polynomials", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/04-polynomials.html", keywords: "monomial, binomial, trinomial, degree, standard form" },
                factoring_polynomials: { title: "1.5 Factoring Polynomials", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/05-factoring-polynomials.html", keywords: "factor, GCF, difference of squares, trinomials" },
                rational_expressions: { title: "1.6 Rational Expressions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/06-coordinate-systems-graphs.html", keywords: "fractions, algebraic fractions, simplify, multiply, divide" },

                // Chapter 2: Equations and Inequalities
                equations_inequalities: { title: "2. Equations & Inequalities", content: "Solving various types of equations and inequalities.", keywords: "solving, solutions, sets, intervals" },
                coord_systems_graphs: { title: "2.1 Coordinate Systems & Graphs", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/06-coordinate-systems-graphs.html", keywords: "cartesian, plane, x-axis, y-axis, plot, points" },
                linear_eq_one_var: { title: "2.2 Linear Equations in One Variable", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/07-linear-equations-one-variable.html", keywords: "solve for x, one solution, no solution, infinite solutions" },
                models_applications: { title: "2.3 Models & Applications", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/08-models-applications.html", keywords: "word problems, real world, distance, rate, time, mixture" },
                complex_numbers: { title: "2.4 Complex Numbers", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/09-complex-numbers.html", keywords: "imaginary, i, standard form, conjugate" },
                quadratic_equations: { title: "2.5 Quadratic Equations", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/10-quadratic-equations.html", keywords: "ax^2+bx+c, quadratic formula, complete the square, discriminant" },
                other_eq_types: { title: "2.6 Other Types of Equations", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/10.5-other-types-equation.html", keywords: "radical, absolute value, rational, higher degree" },
                linear_abs_inequalities: { title: "2.7 Linear & Absolute Value Inequalities", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/11-linear-absolute-value.html", keywords: "greater than, less than, interval notation" },

                // Chapter 3: Functions
                functions: { title: "3. Functions", content: "Exploring the concept of functions, their properties, and operations.", keywords: "input, output, relation, mapping" },
                func_notation: { title: "3.1 Functions & Function Notation", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/12-function-function-notation.html", keywords: "f(x), evaluating, vertical line test" },
                domain_range: { title: "3.2 Domain & Range", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/13-domain-range.html", keywords: "input values, output values, set-builder, interval notation" },
                rate_change_behavior: { title: "3.3 Rates of Change & Graph Behavior", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/14-rate-of-change-graph-behavior.html", keywords: "slope, increasing, decreasing, constant, local maxima, minima" },
                composition_functions: { title: "3.4 Composition of Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/15-composition-of-functions.html", keywords: "f(g(x)), combining functions, composite" },
                transformation_functions: { title: "3.5 Transformation of Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/16-transformation-functions.html", keywords: "shift, reflect, stretch, compress, parent function" },
                abs_value_functions: { title: "3.6 Absolute Value Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/17-absolute-value-functions.html", keywords: "v-shape, vertex, transformations" },
                inverse_functions: { title: "3.7 Inverse Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/18-inverse-functions.html", keywords: "one-to-one, horizontal line test, f^-1(x), switch x and y" },

                // Chapter 4: Linear Functions
                linear_functions: { title: "4. Linear Functions", content: "In-depth study of linear functions and their applications.", keywords: "line, slope, y-intercept, constant rate of change" },
                linear_functions_intro: { title: "4.1 Linear Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/19-linear-functions.html", keywords: "slope-intercept, point-slope, standard form" },
                modeling_linear_functions: { title: "4.2 Modeling with Linear Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/20-modelling-linear-function.html", keywords: "word problems, linear models, prediction, interpolation, extrapolation" },
                fitting_linear_models: { title: "4.3 Fitting Linear Models to Data", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/21-fitting-linear-models.html", keywords: "scatter plot, regression, line of best fit, correlation" },

                // Chapter 5: Polynomial and Rational Functions
                poly_rational_functions: { title: "5. Polynomial & Rational Functions", content: "Analysis of polynomial and rational functions.", keywords: "curves, end behavior, asymptotes" },
                quadratic_functions: { title: "5.1 Quadratic Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/22-qudratic-functions.html", keywords: "parabola, vertex, axis of symmetry, maximum, minimum" },
                power_poly_functions: { title: "5.2 Power & Polynomial Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/23-power-polynomial-functions.html", keywords: "end behavior, degree, leading coefficient, turning points" },
                graphs_poly_functions: { title: "5.3 Graphs of Polynomial Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/24-graph-of-polynomial-functions.html", keywords: "zeros, multiplicity, intermediate value theorem" },
                dividing_poly: { title: "5.4 Dividing Polynomials", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/24.5-dividing-polynomials.html", keywords: "long division, synthetic division, remainder theorem, factor theorem" },
                zeros_poly_functions: { title: "5.5 Zeros of Polynomial Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/25-zeros-of-polynomial-functions.html", keywords: "roots, rational zero theorem, fundamental theorem of algebra" },
                rational_functions: { title: "5.6 Rational Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/26-rational-functions.html", keywords: "asymptotes, vertical, horizontal, slant, holes" },
                inverses_radical_functions: { title: "5.7 Inverses & Radical Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/27-inverses-radical-functions.html", keywords: "square root function, cube root function, inverse" },
                modeling_variation: { title: "5.8 Modeling Using Variation", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/28-modelling-variations.html", keywords: "direct, inverse, joint, combined variation" },

                // Chapter 6: Exponential and Logarithmic Functions
                exp_log_functions: { title: "6. Exponential & Logarithmic Functions", content: "Study of exponential and logarithmic functions, their properties, and applications.", keywords: "growth, decay, inverse operations" },
                exp_functions: { title: "6.1 Exponential Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/29-exponential-functions.html", keywords: "exponential growth, decay, compound interest, e" },
                graphs_exp_functions: { title: "6.2 Graphs of Exponential Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/30-graph-exponential-functions.html", keywords: "asymptote, transformations, graphing" },
                log_functions: { title: "6.3 Logarithmic Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/31-logarithmic-functions.html", keywords: "log, common log, natural log, ln" },
                graphs_log_functions: { title: "6.4 Graphs of Logarithmic Functions", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/32-graph-logarithmic-functions.html", keywords: "asymptote, transformations, graphing, domain" },
                log_properties: { title: "6.5 Logarithmic Properties", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/33-logarithmic-properties.html", keywords: "product rule, quotient rule, power rule, change of base" },
                exp_log_equations: { title: "6.6 Exponential & Logarithmic Equations", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/34-exponential-logarithmic-equations.html", keywords: "solving, one-to-one property" },
                exp_log_models: { title: "6.7 Exponential & Logarithmic Models", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/35-exponential-logarithmic-models.html", keywords: "growth, decay, half-life, doubling time, pH, Richter scale" },
                fitting_exp_models: { title: "6.8 Fitting Exponential Models to Data", url: "https://ariz31.github.io/Arizval.com/ALGEBRA/36-fitting-exponential-models.html", keywords: "regression, exponential, logarithmic, logistic" },
            };

            const structure = {
                prerequisites: ['real_numbers', 'exponents_sci_notation', 'radicals_rational_exponents', 'polynomials_prereq', 'factoring_polynomials', 'rational_expressions'],
                equations_inequalities: ['coord_systems_graphs', 'linear_eq_one_var', 'models_applications', 'complex_numbers', 'quadratic_equations', 'other_eq_types', 'linear_abs_inequalities'],
                functions: ['func_notation', 'domain_range', 'rate_change_behavior', 'composition_functions', 'transformation_functions', 'abs_value_functions', 'inverse_functions'],
                linear_functions: ['linear_functions_intro', 'modeling_linear_functions', 'fitting_linear_models'],
                poly_rational_functions: ['quadratic_functions', 'power_poly_functions', 'graphs_poly_functions', 'dividing_poly', 'zeros_poly_functions', 'rational_functions', 'inverses_radical_functions', 'modeling_variation'],
                exp_log_functions: ['exp_functions', 'graphs_exp_functions', 'log_functions', 'graphs_log_functions', 'log_properties', 'exp_log_equations', 'exp_log_models', 'fitting_exp_models']
            };
            // ========= DYNAMIC CONTENT SECTION END =========


            // --- CORE VISUALIZATION LOGIC ---
            const hierarchyRoot = { id: ROOT_NODE_ID, level: 0, children: [] };
            for (const catId in structure) {
                if (mindMapInfo[catId]) {
                    const categoryNode = { id: catId, level: 1, _children: [] };
                    hierarchyRoot.children.push(categoryNode);
                    if (structure[catId] && structure[catId].length > 0) {
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) {
                                categoryNode._children.push({ id: topicId, level: 2 });
                            }
                        });
                    }
                }
            }
            
            const mindMapContainer = document.getElementById('mind-map-container');
            const listViewContainer = document.getElementById('list-view-container');
            const infoModal = document.getElementById('info-modal');
            const shareModal = document.getElementById('share-modal');
            const themeToggleButton = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const menuToggleButton = document.getElementById('menu-toggle-btn');
            const toolbar = document.getElementById('toolbar');
            
            let simulation, svg, g, linkGroup, nodeGroup, link, node, zoom;
            let sequentialNavigableNodes = [];
            let highlightedNodeIndex = -1;

            function getVisibleNodesAndLinks(root) {
                const visibleNodes = [];
                const visibleLinks = [];
                function recurse(node) {
                    if (!node) return;
                    visibleNodes.push(node);
                    if (node.children) {
                        node.children.forEach(child => {
                            visibleLinks.push({ source: node, target: child });
                            recurse(child);
                        });
                    }
                }
                recurse(root);
                return { nodes: visibleNodes, links: visibleLinks };
            }

            function updateGraph(callback) {
                const { nodes: currentNodes, links: currentLinks } = getVisibleNodesAndLinks(hierarchyRoot);
                
                const tempSvg = d3.select(document.body).append("svg").attr("class", "absolute -left-full");
                currentNodes.forEach(n => {
                    const textEl = tempSvg.append("text")
                        .attr("class", `node level-${n.level}`)
                        .style("font-size", n.level === 0 ? "16px" : n.level === 1 ? "14px" : "12px")
                        .style("font-weight", n.level < 2 ? "600" : "500")
                        .text(mindMapInfo[n.id].title);
                    const bbox = textEl.node().getBBox();
                    n.width = bbox.width + (n.level === 1 ? 40 : 30);
                    n.height = bbox.height + 20;
                });
                tempSvg.remove();

                node = nodeGroup.selectAll(".node").data(currentNodes, d => d.id)
                    .join(
                        enter => {
                            const nodeEnter = enter.append("g")
                                .attr("class", d => `node level-${d.level}`)
                                .call(drag(simulation))
                                .on("click", handleNodeClick);
                            nodeEnter.append("rect");
                            nodeEnter.append("text");
                            return nodeEnter;
                        },
                        update => update,
                        exit => exit.transition().duration(300).attr("transform", "scale(0)").remove()
                    );
                
                node.classed("collapsed", d => d._children && !d.children);
                node.select("rect").transition().duration(300)
                    .attr("width", d => d.width).attr("height", d => d.height)
                    .attr("x", d => -d.width / 2).attr("y", d => -d.height / 2);
                node.select("text").text(d => mindMapInfo[d.id].title);

                link = linkGroup.selectAll(".link").data(currentLinks, d => `${d.source.id}-${d.target.id}`)
                    .join(
                        enter => enter.append("line").attr("class", "link").attr("stroke-opacity", 0),
                        update => update,
                        exit => exit.transition().duration(300).attr("stroke-opacity", 0).remove()
                    );
                link.transition().duration(300).attr("stroke-opacity", 1);

                simulation.nodes(currentNodes);
                simulation.force("link").links(currentLinks);
                simulation.alpha(0.8).restart();

                if (callback) {
                    simulation.on('end.callback', callback);
                }
            }

            function openInfoModal(nodeId) {
                const data = mindMapInfo[nodeId];
                if (data && data.content) {
                    document.getElementById('modal-title').innerHTML = data.title;
                    const modalBody = document.getElementById('modal-body');
                    modalBody.innerHTML = data.content;
                    
                    if (window.renderMathInElement) {
                        window.renderMathInElement(modalBody, {
                            delimiters: [
                                {left: '$$', right: '$$', display: true},
                                {left: '$', right: '$', display: false}
                            ],
                            throwOnError: false
                        });
                    }
                    infoModal.classList.add('active');
                }
            }

            function handleNodeClick(event, d) {
                if (event.defaultPrevented) return;
                
                const nodeInfo = mindMapInfo[d.id];
                
                highlightNode(d.id, false);

                if (d.level === 1 && d._children) { // If a chapter is clicked
                    const firstChildId = d._children[0].id;
                    highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === firstChildId) -1;
                } else if (d.level === 2) { // If a topic is clicked
                     highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === d.id);
                } else {
                    highlightedNodeIndex = -1; // Reset for root node
                }

                if (nodeInfo.url) {
                    window.open(nodeInfo.url, '_blank');
                    return;
                }

                if (d.id === ROOT_NODE_ID) {
                    toggleAllNodes();
                } else if (d._children && d._children.length > 0) {
                    d.children = d.children ? null : d._children;
                    updateGraph();
                } else if (nodeInfo.content) {
                    openInfoModal(d.id);
                }
            }

            function initializeGraph() {
                // Build the sequential navigation list once
                sequentialNavigableNodes = [];
                Object.values(structure).forEach(chapter => {
                    chapter.forEach(topicId => {
                        const nodeData = hierarchyRoot.children
                            .flatMap(c => c._children)
                            .find(n => n.id === topicId);
                        if(nodeData) sequentialNavigableNodes.push(nodeData);
                    });
                });


                if (listViewContainer.classList.contains('hidden')) {
                    const width = mindMapContainer.clientWidth;
                    const height = mindMapContainer.clientHeight;

                    d3.select(mindMapContainer).select("svg").remove();
                    svg = d3.select(mindMapContainer).append("svg").attr("viewBox", [0, 0, width, height]);
                    g = svg.append("g");

                    linkGroup = g.append("g").attr("class", "links");
                    nodeGroup = g.append("g").attr("class", "nodes");

                    simulation = d3.forceSimulation()
                        .force("link", d3.forceLink().id(d => d.id).distance(d => (d.source.level === 0 ? 200 : 120)).strength(0.9))
                        .force("charge", d3.forceManyBody().strength(-800))
                        .force("center", d3.forceCenter(width / 2, height / 2))
                        .force("collide", d3.forceCollide().radius(d => d.width / 2 + 15).strength(1))
                        .on("tick", () => {
                            if(link) link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                            if(node) node.attr("transform", d => `translate(${d.x},${d.y})`);
                        });
                    
                    zoom = d3.zoom().scaleExtent([0.1, 3]).on("zoom", e => g.attr("transform", e.transform));
                    svg.call(zoom);
                    
                    hierarchyRoot.children.forEach(child => child.children = null);
                    updateGraph();
                }
            }
            
            function drag(simulation) {
                function dragstarted(event, d) { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; }
                function dragged(event, d) { d.fx = event.x; d.fy = event.y; }
                function dragended(event, d) { if (!event.active) simulation.alphaTarget(0); if (d.id !== ROOT_NODE_ID) { d.fx = null; d.fy = null; } }
                return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
            }

            function resetView() {
                if (svg && zoom) {
                    svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
                }
            }

            function toggleAllNodes() {
                const shouldCollapseAll = hierarchyRoot.children.some(c => c.children);
                hierarchyRoot.children.forEach(child => {
                    child.children = shouldCollapseAll ? null : (child._children || null);
                });
                updateGraph();
            }

            function generateListView() {
                let html = `<h1>${mindMapInfo[ROOT_NODE_ID].title}</h1>`;
                for (const catId in structure) {
                    if (mindMapInfo[catId]) {
                        html += `<h2 data-id="${catId}">${mindMapInfo[catId].title}</h2>`;
                        html += '<ul>';
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) {
                                html += `<li data-id="${topicId}">${mindMapInfo[topicId].title}</li>`;
                            }
                        });
                        html += '</ul>';
                    }
                }
                listViewContainer.innerHTML = html;
                listViewContainer.querySelectorAll('li, h2').forEach(item => {
                    item.addEventListener('click', () => {
                        const info = mindMapInfo[item.dataset.id];
                        if (info.url) {
                            window.open(info.url, '_blank');
                        } else if (info.content) {
                            openInfoModal(item.dataset.id);
                        }
                    });
                });
            }

            function toggleListView() {
                mindMapContainer.classList.toggle('hidden');
                listViewContainer.classList.toggle('hidden');
                if (!listViewContainer.classList.contains('hidden') && listViewContainer.innerHTML === '') {
                    generateListView();
                }
            }
            
            function highlightNode(nodeId, doPan = true) {
                node.classed("highlight", d => d.id === nodeId);
                if (doPan) {
                    // Find the node data from the simulation's current nodes
                    const targetNode = node.data().find(n => n.id === nodeId);
                    if (targetNode && svg && zoom) {
                        const width = mindMapContainer.clientWidth;
                        const height = mindMapContainer.clientHeight;
                        const transform = d3.zoomIdentity
                            .translate(width / 2, height / 2)
                            .scale(d3.zoomTransform(svg.node()).k)
                            .translate(-targetNode.x, -targetNode.y);
                        
                        svg.transition().duration(500).call(zoom.transform, transform);
                    }
                }
            }
            
            function navigate(direction) {
                if (sequentialNavigableNodes.length === 0) return;

                highlightedNodeIndex = (highlightedNodeIndex + direction + sequentialNavigableNodes.length) % sequentialNavigableNodes.length;
                
                const nextNode = sequentialNavigableNodes[highlightedNodeIndex];
                const parentNode = hierarchyRoot.children.find(c => c._children.some(child => child.id === nextNode.id));

                let needsUpdate = false;
                if (parentNode && !parentNode.children) {
                    parentNode.children = parentNode._children;
                    needsUpdate = true;
                }
                
                if (needsUpdate) {
                    updateGraph(() => {
                        // This callback ensures highlight happens after the simulation stabilizes
                        highlightNode(nextNode.id);
                    });
                } else {
                    highlightNode(nextNode.id);
                }
            }

            // --- EVENT LISTENERS ---
            document.getElementById('close-modal-info').addEventListener('click', () => infoModal.classList.remove('active'));
            infoModal.addEventListener('click', (e) => e.target === infoModal && infoModal.classList.remove('active'));
            
            // Theme Toggle
            themeToggleButton.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                themeIconLight.classList.toggle('hidden');
                themeIconDark.classList.toggle('hidden');
            });

            // Share Modal
            const shareBtn = document.getElementById('share-btn');
            const closeShareBtn = document.getElementById('close-modal-share');
            
            shareBtn.addEventListener('click', () => {
                const url = "https://www.arizval.com/mind-maps/algebra/main-map";
                const text = "Check out this interactive College Algebra Mind Map!";
                document.getElementById('share-url').value = url;
                document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
                document.getElementById('share-linkedin').href = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(text)}`;
                shareModal.classList.add('active');
            });
            
            closeShareBtn.addEventListener('click', () => shareModal.classList.remove('active'));
            shareModal.addEventListener('click', (e) => e.target === shareModal && shareModal.classList.remove('active'));
            
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                const urlInput = document.getElementById('share-url');
                urlInput.select();
                urlInput.setSelectionRange(0, 99999); // For mobile
                try {
                    document.execCommand('copy');
                    const feedback = document.getElementById('copy-feedback');
                    feedback.textContent = 'Link copied!';
                    setTimeout(() => feedback.textContent = '', 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
            });


            window.addEventListener('resize', initializeGraph);

            // Toolbar listeners
            menuToggleButton.addEventListener('click', () => {
                toolbar.classList.toggle('expanded');
            });
            document.getElementById('home-btn').addEventListener('click', resetView);
            document.getElementById('toggle-all-btn').addEventListener('click', toggleAllNodes);
            document.getElementById('list-view-btn').addEventListener('click', toggleListView);
            document.getElementById('prev-btn').addEventListener('click', () => navigate(-1));
            document.getElementById('next-btn').addEventListener('click', () => navigate(1));
            
            window.addEventListener('keydown', (e) => {
                if (document.activeElement.tagName === 'INPUT' || infoModal.classList.contains('active') || shareModal.classList.contains('active')) return;
                if (e.key === 'ArrowRight') {
                    navigate(1);
                } else if (e.key === 'ArrowLeft') {
                    navigate(-1);
                }
            });

            // --- INITIALIZATION ---
            initializeGraph();
        });
    </script>
</body>
</html>