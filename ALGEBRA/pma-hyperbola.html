<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Interactive Mind Map: Hyperbola</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMckDMOe6bvJOiFnO4IMUYLz3G92BIUKEp5nA7C8MFFKSSJTI" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-light: #f8fafc; --bg-dark: #0b1120;
            --node-bg-light: #ffffff; --node-bg-dark: #1e293b;
            --text-light: #1e293b; --text-dark: #e2e8f0;
            --border-light: #cbd5e1; --border-dark: #475569;
            --link-light: #94a3b8; --link-dark: #64748b;
            --primary-light: #3b82f6; --primary-dark: #60a5fa;
            --primary-text-light: #ffffff; --primary-text-dark: #0b1120;
            --highlight-border-light: #ef4444; /* Red-500 */
            --highlight-border-dark: #f87171; /* Red-400 */
            
            --cat-bg-expanded-light: #e0e7ff; --cat-border-expanded-light: #a5b4fc; --cat-text-expanded-light: #3730a3;
            --cat-bg-collapsed-light: #e5e7eb; --cat-border-collapsed-light: #9ca3af; --cat-text-collapsed-light: #4b5563;
            --cat-bg-expanded-dark: #312e81; --cat-border-expanded-dark: #818cf8; --cat-text-expanded-dark: #e0e7ff;
            --cat-bg-collapsed-dark: #374151; --cat-border-collapsed-dark: #6b7280; --cat-text-collapsed-dark: #d1d5db;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Inter', sans-serif;
            background-color: var(--bg-light); transition: background-color 0.3s ease;
        }
        body.dark { background-color: var(--bg-dark); }
        #mind-map-container, #list-view-container { width: 100%; height: 100%; position: relative; box-sizing: border-box; }
        #mind-map-container { cursor: grab; }
        #mind-map-container:active { cursor: grabbing; }

        .node { cursor: pointer; }
        .node rect {
            stroke-width: 2.5px; rx: 8; ry: 8;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
            transition: fill 0.3s ease, stroke 0.3s ease, transform 0.2s ease, stroke-width 0.2s ease;
        }
        .node:hover rect { transform: scale(1.05); }
        .node text { pointer-events: none; text-anchor: middle; dominant-baseline: central; font-weight: 500; transition: fill 0.3s ease; }
        .link { stroke-opacity: 0.7; transition: stroke 0.3s ease; }
        .katex { font-size: 1.1em; }

        .node.level-0 rect { fill: var(--primary-light); stroke: var(--primary-light); }
        .node.level-0 text { fill: var(--primary-text-light); font-size: 16px; font-weight: 700; }
        .node.level-1 rect { fill: var(--cat-bg-expanded-light); stroke: var(--cat-border-expanded-light); }
        .node.level-1 text { fill: var(--cat-text-expanded-light); font-size: 14px; font-weight: 600; }
        .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-light); stroke: var(--cat-border-collapsed-light); }
        .node.level-1.collapsed text { fill: var(--cat-text-collapsed-light); }
        .node.level-2 rect { fill: var(--node-bg-light); stroke: var(--border-light); }
        .node.level-2 text { fill: var(--text-light); font-size: 12px; }
        .link { stroke: var(--link-light); }
        
        body.dark .node.level-0 rect { fill: var(--primary-dark); stroke: var(--primary-dark); }
        body.dark .node.level-0 text { fill: var(--primary-text-dark); }
        body.dark .node.level-1 rect { fill: var(--cat-bg-expanded-dark); stroke: var(--cat-border-expanded-dark); }
        body.dark .node.level-1 text { fill: var(--cat-text-expanded-dark); }
        body.dark .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-dark); stroke: var(--cat-border-collapsed-dark); }
        body.dark .node.level-1.collapsed text { fill: var(--cat-text-collapsed-dark); }
        body.dark .node.level-2 rect { fill: var(--node-bg-dark); stroke: var(--border-dark); }
        body.dark .node.level-2 text { fill: var(--text-dark); }
        body.dark .link { stroke: var(--link-dark); }

        .node.highlight rect { stroke: var(--highlight-border-light); stroke-width: 4px; }
        body.dark .node.highlight rect { stroke: var(--highlight-border-dark); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--node-bg-light); color: var(--text-light); padding: 1.5rem; border-radius: 0.75rem; max-width: 90%; width: 600px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease; box-shadow: 0 10px 25px rgba(0,0,0,0.2); display: flex; flex-direction: column; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        body.dark .modal-content { background: var(--node-bg-dark); color: var(--text-dark); }
        .modal-content h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark .modal-content h2 { color: var(--primary-dark); }
        .modal-content h3 { font-size: 1.15rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-light); }
        body.dark .modal-content h3 { color: var(--primary-dark); }
        .modal-content ul { padding-left: 1.5rem; margin-top: 0.5rem; }
        .modal-content li { margin-bottom: 0.25rem; }
        .modal-content code { background-color: #e2e8f0; color: #1e293b; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; }
        body.dark .modal-content code { background-color: #475569; color: #e2e8f0; }
        #modal-body { flex-grow: 1; }
        .modal-footer { margin-top: 1.5rem; border-top: 1px solid var(--border-light); padding-top: 1rem; display: flex; justify-content: flex-end; gap: 0.5rem; }
        body.dark .modal-footer { border-top-color: var(--border-dark); }
        .ai-button { background-color: var(--primary-light); color: var(--primary-text-light); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s; }
        .ai-button:hover { background-color: #2563eb; }
        body.dark .ai-button { background-color: var(--primary-dark); color: var(--primary-text-dark); }
        body.dark .ai-button:hover { background-color: #93c5fd; }
        
        /* AI Modal Specific Styles */
        .loader { width: 48px; height: 48px; border: 5px solid; border-color: var(--primary-light) transparent; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        body.dark .loader { border-color: var(--primary-dark) transparent; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


        #toolbar { position: fixed; z-index: 500; top: 50%; right: 1rem; transform: translateY(-50%); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
        #toolbar.expanded { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(200, 200, 200, 0.5); border-radius: 9999px; padding: 0.5rem; }
        body.dark #toolbar.expanded { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(71, 85, 105, 0.5); }
        #toolbar-tools { display: flex; flex-direction: column; gap: 0.5rem; max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.25, 1, 0.5, 1), padding 0.5s ease; }
        #toolbar.expanded #toolbar-tools { max-height: 500px; }
        .toolbar-divider { width: 80%; height: 1px; margin: 0.25rem auto; background-color: #e2e8f0; }
        body.dark .toolbar-divider { background-color: #475569; }

        #list-view-container { padding: 2rem; overflow-y: auto; background-color: var(--bg-light); color: var(--text-light); box-sizing: border-box; height: 100%; }
        body.dark #list-view-container { background-color: var(--bg-dark); color: var(--text-dark); }
        #list-view-container h1 { font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark #list-view-container h1 { color: var(--primary-dark); }
        #list-view-container h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 2px solid var(--border-light); padding-bottom: 0.5rem; }
        body.dark #list-view-container h2 { border-bottom-color: var(--border-dark); }
        #list-view-container ul { list-style: none; padding-left: 1rem; }
        #list-view-container li { padding: 0.5rem; margin: 0.25rem 0; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; }
        #list-view-container li:hover { background-color: rgba(0,0,0,0.05); }
        body.dark #list-view-container li:hover { background-color: rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div id="mind-map-container"></div>
    <div id="list-view-container" class="hidden"></div>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div>
                <div class="flex justify-between items-center mb-4">
                    <h2 id="modal-title"></h2>
                    <button id="close-modal-info" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">×</button>
                </div>
                <div id="modal-body"></div>
            </div>
            <div class="modal-footer">
                <button id="ai-explain-btn" class="ai-button">✨ Explain Further</button>
                <button id="ai-strategy-btn" class="ai-button">✨ Suggest Strategies</button>
            </div>
        </div>
    </div>
    
    <div id="ai-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="ai-modal-title">AI Assistant</h2>
                <button id="close-modal-ai" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">×</button>
            </div>
            <div id="ai-modal-body" class="prose dark:prose-invert max-w-none">
                <div id="ai-loader" class="flex justify-center items-center p-8">
                    <div class="loader"></div>
                </div>
                <div id="ai-content"></div>
            </div>
        </div>
    </div>

    <div id="share-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">Share Mind Map</h2>
                <button id="close-modal-share" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">×</button>
            </div>
            <div class="space-y-4">
                <p class="text-sm text-gray-600 dark:text-gray-400">Share this interactive mind map with others!</p>
                <div class="relative">
                    <input id="share-url" type="text" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700" readonly>
                    <button id="copy-link-btn" class="absolute right-1 top-1/2 -translate-y-1/2 p-2 bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    </button>
                </div>
                <p id="copy-feedback" class="text-sm text-green-600 dark:text-green-400 h-4 text-center"></p>
            </div>
        </div>
    </div>

    <div id="toolbar">
        <button id="menu-toggle-btn" title="Toggle Menu" class="p-3 rounded-full bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
        <div id="toolbar-tools">
            <button id="home-btn" title="Reset View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            </button>
            <button id="toggle-all-btn" title="Expand/Collapse All" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4h4m12 4V4h-4M4 16v4h4m12-4v4h-4" /></svg>
            </button>
            <button id="list-view-btn" title="List View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="prev-btn" title="Previous Topic (Left Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="next-btn" title="Next Topic (Right Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="share-btn" title="Share" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" /></svg>
            </button>
            <button id="theme-toggle" title="Toggle Dark Mode" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ========= DYNAMIC CONTENT SECTION START =========
            // THIS IS THE ONLY SECTION YOU WILL EDIT.
            // REPLACE THE CONTENT BELOW WITH YOUR TOPIC'S DATA.

            const ROOT_NODE_ID = 'hyperbola';

            const mindMapInfo = {
                hyperbola: {
                    title: "Hyperbola",
                    content: `
                        <p>A hyperbola is a smooth curve in a plane, which can be defined either by its geometric properties or by the equations for which it is the solution set. It is one of the three types of conic sections, formed by the intersection of a plane and a double cone.</p>
                        <h3>How to Use This Mind Map</h3>
                        <ul>
                            <li><strong>Click Nodes:</strong> Click a category to expand/collapse. Click a concept for details.</li>
                            <li><strong>Pan & Zoom:</strong> Drag the background to pan. Use your mouse wheel to zoom.</li>
                            <li><strong>Toolbar:</strong> Use the floating toolbar for more options like resetting the view, toggling dark mode, and sharing.</li>
                        </ul>`,
                    keywords: "hyperbola, conic section, geometry, math, algebra"
                },
                definition_and_concepts: {
                    title: "Definition & Core Concepts",
                    content: "<p>This section covers the fundamental definitions of a hyperbola, both as a locus of points and as a conic section.</p>",
                    keywords: "definition, locus, conic section, geometry"
                },
                geometric_definition: {
                    title: "Geometric Definition",
                    content: `<h3>Locus of Points</h3>
                             <p>A hyperbola is the set of all points in a plane, the difference of whose distances from two fixed points (the foci) is a positive constant. This constant is equal to the distance between the vertices ($2a$).</p>
                             <p>If $P$ is any point on the hyperbola, and $F_1$ and $F_2$ are the foci, then $|PF_1 - PF_2| = 2a$.</p>`,
                    keywords: "locus of points, foci, distance, constant difference"
                },
                as_a_conic_section: {
                    title: "As a Conic Section",
                    content: `<h3>Intersection of a Cone and Plane</h3>
                             <p>A hyperbola is formed when a plane intersects a double-napped cone at an angle steeper than the slope of the cone's side. This intersection cuts through both nappes (halves) of the cone, creating two separate, unbounded curves called branches.</p>`,
                    keywords: "conic section, cone, plane, intersection, branches"
                },
                key_components: {
                    title: "Key Components",
                    content: "<p>Explore the essential parts that make up a hyperbola, defining its shape and orientation.</p>",
                    keywords: "foci, vertices, asymptotes, axes, center"
                },
                foci_and_center: {
                    title: "Foci and Center",
                    content: `<h3>Foci ($F_1, F_2$)</h3>
                             <p>The two fixed points that define the hyperbola. The distance from the center to each focus is denoted by $c$.</p>
                             <h3>Center $(h, k)$</h3>
                             <p>The midpoint of the line segment connecting the foci. It is also the intersection point of the transverse and conjugate axes.</p>`,
                    keywords: "foci, focus, center, midpoint"
                },
                vertices_and_axes: {
                    title: "Vertices and Axes",
                    content: `<h3>Vertices</h3>
                             <p>The two points where the hyperbola intersects its transverse axis. The distance between the two vertices is $2a$.</p>
                             <h3>Transverse Axis</h3>
                             <p>The line segment that connects the two vertices and passes through the center and foci. Its length is $2a$.</p>
                             <h3>Conjugate Axis</h3>
                             <p>The line segment perpendicular to the transverse axis, passing through the center. Its length is $2b$.</p>`,
                    keywords: "vertices, vertex, transverse axis, conjugate axis"
                },
                asymptotes: {
                    title: "Asymptotes",
                    content: `<h3>Guiding Lines</h3>
                             <p>Asymptotes are straight lines that the branches of the hyperbola approach as they extend to infinity. They pass through the center and form the diagonals of a "central rectangle" whose dimensions are $2a$ by $2b$. The equations for a hyperbola centered at the origin are $y = \pm \frac{b}{a}x$.</p>`,
                    keywords: "asymptotes, lines, infinity, central rectangle"
                },
                standard_equations: {
                    title: "Standard Equations",
                    content: "<p>This section details the standard forms of a hyperbola's equation when its center is at the origin $(0,0)$.</p>",
                    keywords: "equation, formula, standard form, algebra"
                },
                horizontal_hyperbola: {
                    title: "Horizontal Hyperbola",
                    content: `<h3>Transverse Axis on the x-axis</h3>
                             <p>The standard equation for a hyperbola that opens left and right is:</p>
                             $$ \frac{x^2}{a^2} - \frac{y^2}{b^2} = 1 $$
                             <ul>
                                <li><strong>Vertices:</strong> $(\pm a, 0)$</li>
                                <li><strong>Foci:</strong> $(\pm c, 0)$</li>
                                <li><strong>Asymptotes:</strong> $y = \pm \frac{b}{a}x$</li>
                             </ul>`,
                    keywords: "horizontal, x-axis, equation, formula"
                },
                vertical_hyperbola: {
                    title: "Vertical Hyperbola",
                    content: `<h3>Transverse Axis on the y-axis</h3>
                             <p>The standard equation for a hyperbola that opens up and down is:</p>
                             $$ \frac{y^2}{a^2} - \frac{x^2}{b^2} = 1 $$
                             <ul>
                                <li><strong>Vertices:</strong> $(0, \pm a)$</li>
                                <li><strong>Foci:</strong> $(0, \pm c)$</li>
                                <li><strong>Asymptotes:</strong> $y = \pm \frac{a}{b}x$</li>
                             </ul>`,
                    keywords: "vertical, y-axis, equation, formula"
                },
                abc_relationship: {
                    title: "Relationship of a, b, c",
                    content: `<h3>The Hyperbolic Pythagorean Relation</h3>
                             <p>The values $a$, $b$, and $c$ are related by the equation:</p>
                             $$ c^2 = a^2 + b^2 $$
                             <p>This is different from the ellipse's relation. Here, $c$ (the distance to the focus) is always the largest value.</p>`,
                    keywords: "pythagorean, relation, formula, foci, vertices"
                },
                properties_and_behavior: {
                    title: "Properties & Behavior",
                    content: "<p>Learn about key properties that describe the specific shape and characteristics of a hyperbola.</p>",
                    keywords: "eccentricity, latus rectum, properties"
                },
                eccentricity: {
                    title: "Eccentricity (e)",
                    content: `<h3>Measure of 'Openness'</h3>
                             <p>Eccentricity measures how much a hyperbola deviates from being a parabola. It is defined as the ratio of the distance from the center to a focus ($c$) to the distance from the center to a vertex ($a$).</p>
                             $$ e = \frac{c}{a} $$
                             <p>For any hyperbola, the eccentricity is always greater than 1 ($e > 1$). The larger the value of $e$, the more "open" or wide the branches of the hyperbola are.</p>`,
                    keywords: "eccentricity, ratio, shape, openness"
                },
                latus_rectum: {
                    title: "Latus Rectum",
                    content: `<h3>Focal Chord</h3>
                             <p>The latus rectum is a line segment passing through a focus, perpendicular to the transverse axis, with endpoints on the hyperbola. It measures the 'width' of the hyperbola at the focus.</p>
                             <p>The length of the latus rectum is given by the formula:</p>
                             $$ \text{Length} = \frac{2b^2}{a} $$`,
                    keywords: "latus rectum, focal chord, width, focus"
                },
                real_world_applications: {
                    title: "Real-World Applications",
                    content: "<p>Hyperbolas are not just abstract concepts; they appear in many areas of science, technology, and nature.</p>",
                    keywords: "applications, real world, technology, science"
                },
                astronomy: {
                    title: "Astronomy & Orbits",
                    content: `<h3>Celestial Paths</h3>
                             <p>The paths of some comets and other celestial bodies that are not bound by a star's gravity follow a hyperbolic trajectory. They make a single pass around the star and then travel off into space, never to return.</p>`,
                    keywords: "astronomy, orbits, comets, space, gravity"
                },
                navigation_systems: {
                    title: "Navigation Systems",
                    content: `<h3>LORAN & GPS</h3>
                             <p>Long-Range Navigation (LORAN) systems determine the position of a ship or aircraft by measuring the time difference between receiving signals from two synchronized transmitters. The set of all possible locations for a given time difference forms a hyperbola. Using a third transmitter creates a second hyperbola, and the intersection of the two gives the precise location.</p>`,
                    keywords: "navigation, loran, gps, signals, location"
                },
                engineering: {
                    title: "Engineering Structures",
                    content: `<h3>Cooling Towers</h3>
                             <p>The distinctive shape of many nuclear power plant cooling towers is a hyperboloid (a 3D hyperbola rotated around its axis). This shape provides excellent structural strength and stability while using a minimum of material. It also promotes efficient cooling of water through natural convection.</p>`,
                    keywords: "engineering, cooling tower, structure, hyperboloid"
                },
                optics_and_acoustics: {
                    title: "Optics & Acoustics",
                    content: `<h3>Focusing Properties</h3>
                             <p>Hyperbolic mirrors and lenses are used in telescopes (like Cassegrain telescopes) to reflect and focus light from a wide area to a single point. Similarly, the shock wave created by an aircraft breaking the sound barrier (a sonic boom) forms a cone that intersects the ground in the shape of a hyperbola.</p>`,
                    keywords: "optics, acoustics, telescope, lens, sonic boom"
                }
            };

            const structure = {
                definition_and_concepts: ['geometric_definition', 'as_a_conic_section'],
                key_components: ['foci_and_center', 'vertices_and_axes', 'asymptotes'],
                standard_equations: ['horizontal_hyperbola', 'vertical_hyperbola', 'abc_relationship'],
                properties_and_behavior: ['eccentricity', 'latus_rectum'],
                real_world_applications: ['astronomy', 'navigation_systems', 'engineering', 'optics_and_acoustics']
            };

            // ========= DYNAMIC CONTENT SECTION END =========


            // --- CORE LOGIC (DO NOT EDIT) ---
            document.title = mindMapInfo[ROOT_NODE_ID] ? `Interactive Mind Map: ${mindMapInfo[ROOT_NODE_ID].title}` : 'Interactive Mind Map';
            const hierarchyRoot = { id: ROOT_NODE_ID, level: 0, children: [] };
            for (const catId in structure) {
                if (mindMapInfo[catId]) {
                    const categoryNode = { id: catId, level: 1, _children: [] };
                    hierarchyRoot.children.push(categoryNode);
                    if (structure[catId] && structure[catId].length > 0) {
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) {
                                categoryNode._children.push({ id: topicId, level: 2 });
                            }
                        });
                    }
                }
            }
            
            const mindMapContainer = document.getElementById('mind-map-container');
            const listViewContainer = document.getElementById('list-view-container');
            const infoModal = document.getElementById('info-modal');
            const shareModal = document.getElementById('share-modal');
            const aiModal = document.getElementById('ai-modal');
            const themeToggleButton = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const menuToggleButton = document.getElementById('menu-toggle-btn');
            const toolbar = document.getElementById('toolbar');
            
            let simulation, svg, g, linkGroup, nodeGroup, link, node, zoom;
            let sequentialNavigableNodes = [];
            let highlightedNodeIndex = -1;
            let currentNodeIdForAI = null;

            async function generateGeminiContent(prompt, cacheKey) {
                const aiLoader = document.getElementById('ai-loader');
                const aiContent = document.getElementById('ai-content');
                aiContent.innerHTML = '';
                aiLoader.style.display = 'flex';
                aiModal.classList.add('active');

                const apiKey = ""; // The environment will provide the key
                if (!apiKey) {
                    aiContent.innerHTML = `<p class="text-red-500"><strong>API Key Not Provided.</strong><br>This feature requires a valid Google Gemini API key to be set in the script.</p>`;
                    aiLoader.style.display = 'none';
                    return;
                }
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-flash:generateContent?key=${apiKey}`;
                
                const payload = { contents: [{ parts: [{ text: prompt }] }] };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates[0].content.parts[0].text) {
                        const text = result.candidates[0].content.parts[0].text;
                        aiContent.innerHTML = text;
                    } else {
                        throw new Error("Invalid response structure from API.");
                    }
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    aiContent.innerHTML = `<p class="text-red-500">Sorry, there was an error generating the content. Please check the console for details.</p>`;
                } finally {
                    aiLoader.style.display = 'none';
                }
            }
            
            document.getElementById('ai-explain-btn').addEventListener('click', () => {
                if (!currentNodeIdForAI) return;
                const data = mindMapInfo[currentNodeIdForAI];
                const topicTitle = mindMapInfo[ROOT_NODE_ID].title;
                document.getElementById('ai-modal-title').innerText = `Explanation for: ${data.title}`;
                const prompt = `In the context of "${topicTitle}", please elaborate on the following specific point. Provide a detailed explanation in well-structured HTML format (using h3, p, ul, li tags). Do not include <html> or <body> tags.\n\n### Point to Expand:\n**Title:** ${data.title}\n**Current Description:** ${data.content.replace(/<[^>]*>?/gm, ' ')}`;
                generateGeminiContent(prompt);
            });

            document.getElementById('ai-strategy-btn').addEventListener('click', () => {
                if (!currentNodeIdForAI) return;
                const data = mindMapInfo[currentNodeIdForAI];
                document.getElementById('ai-modal-title').innerText = `Strategies for: ${data.title}`;
                const prompt = `Based on the topic "${data.title}", generate a list of 3 to 5 actionable strategies a business or individual could implement. Format the output as an HTML unordered list (<ul><li><strong>Strategy Name:</strong> Description...</li></ul>). Do not include <html> or <body> tags.`;
                generateGeminiContent(prompt);
            });

            function getVisibleNodesAndLinks(root) {
                const visibleNodes = [], visibleLinks = [];
                function recurse(node) {
                    if (!node) return;
                    visibleNodes.push(node);
                    if (node.children) {
                        node.children.forEach(child => {
                            visibleLinks.push({ source: node, target: child });
                            recurse(child);
                        });
                    }
                }
                recurse(root);
                return { nodes: visibleNodes, links: visibleLinks };
            }

            function updateGraph(callback) {
                const { nodes: currentNodes, links: currentLinks } = getVisibleNodesAndLinks(hierarchyRoot);
                
                // Dynamically adjust forces based on graph size
                const nodeCount = currentNodes.length;
                const chargeStrength = Math.max(-2000, -150 * nodeCount); // More repulsion for more nodes
                simulation.force("charge").strength(chargeStrength);
                simulation.force("link").distance(d => {
                    if (d.source.level === 0) return Math.max(180, 15 * (d.source.children?.length || 5)); // Push categories further out if many
                    return 100;
                }).strength(1);

                const tempSvg = d3.select(document.body).append("svg").attr("class", "absolute -left-full");
                currentNodes.forEach(n => {
                    const textEl = tempSvg.append("text")
                        .attr("class", `node level-${n.level}`)
                        .style("font-size", n.level === 0 ? "16px" : n.level === 1 ? "14px" : "12px")
                        .style("font-weight", n.level < 2 ? "700" : "500")
                        .text(mindMapInfo[n.id].title);
                    const bbox = textEl.node().getBBox();
                    n.width = bbox.width + (n.level === 1 ? 40 : 30);
                    n.height = bbox.height + 20;
                });
                tempSvg.remove();

                node = nodeGroup.selectAll(".node").data(currentNodes, d => d.id)
                    .join(
                        enter => {
                            const nodeEnter = enter.append("g")
                                .attr("class", d => `node level-${d.level}`)
                                .call(drag(simulation))
                                .on("click", handleNodeClick);
                            nodeEnter.append("rect");
                            nodeEnter.append("text");
                            return nodeEnter;
                        },
                        update => update,
                        exit => exit.transition().duration(300).attr("transform", "scale(0)").remove()
                    );
                
                node.classed("collapsed", d => d._children && !d.children);
                node.select("rect").transition().duration(300)
                    .attr("width", d => d.width).attr("height", d => d.height)
                    .attr("x", d => -d.width / 2).attr("y", d => -d.height / 2);
                node.select("text").text(d => mindMapInfo[d.id].title);

                link = linkGroup.selectAll(".link").data(currentLinks, d => `${d.source.id}-${d.target.id}`)
                    .join(
                        enter => enter.append("line").attr("class", "link").attr("stroke-opacity", 0),
                        update => update,
                        exit => exit.transition().duration(300).attr("stroke-opacity", 0).remove()
                    );
                link.transition().duration(300).attr("stroke-opacity", 0.7);

                simulation.nodes(currentNodes);
                simulation.force("link").links(currentLinks);
                simulation.alpha(1).restart();

                if (callback) {
                    simulation.on('end.callback', () => {
                        callback();
                        simulation.on('end.callback', null);
                    });
                }
            }

            function openInfoModal(nodeId) {
                currentNodeIdForAI = nodeId;
                const data = mindMapInfo[nodeId];
                if (data && data.content) {
                    document.getElementById('modal-title').innerHTML = data.title;
                    const modalBody = document.getElementById('modal-body');
                    modalBody.innerHTML = data.content;
                    if (window.renderMathInElement) {
                        window.renderMathInElement(modalBody, {
                            delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false} ],
                            throwOnError: false
                        });
                    }
                    infoModal.classList.add('active');
                }
            }

            function handleNodeClick(event, d) {
                if (event.defaultPrevented) return;
                const nodeInfo = mindMapInfo[d.id];
                highlightNode(d.id, false);
                if (d.level === 1) { // Category node
                    d.children = d.children ? null : d._children;
                    updateGraph();
                } else if (nodeInfo.content) {
                    openInfoModal(d.id);
                    highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === d.id);
                }
            }

            function initializeGraph() {
                sequentialNavigableNodes = [];
                Object.values(structure).forEach(chapter => {
                    chapter.forEach(topicId => {
                        const parent = Object.keys(structure).find(key => structure[key].includes(topicId));
                        const parentNode = hierarchyRoot.children.find(c => c.id === parent);
                        const nodeData = parentNode?._children.find(n => n.id === topicId);
                        if(nodeData) sequentialNavigableNodes.push(nodeData);
                    });
                });

                if (!mindMapContainer.classList.contains('hidden')) {
                    const width = mindMapContainer.clientWidth;
                    const height = mindMapContainer.clientHeight;
                    d3.select(mindMapContainer).select("svg").remove();
                    svg = d3.select(mindMapContainer).append("svg").attr("viewBox", [0, 0, width, height]);
                    g = svg.append("g");
                    linkGroup = g.append("g").attr("class", "links");
                    nodeGroup = g.append("g").attr("class", "nodes");
                    
                    simulation = d3.forceSimulation()
                        .force("link", d3.forceLink().id(d => d.id))
                        .force("charge", d3.forceManyBody())
                        .force("center", d3.forceCenter(width / 2, height / 2))
                        .force("collide", d3.forceCollide().radius(d => d.width / 2 + 15).strength(1))
                        .on("tick", () => {
                            if(link) link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                            if(node) node.attr("transform", d => `translate(${d.x},${d.y})`);
                        });

                    zoom = d3.zoom().scaleExtent([0.1, 3]).on("zoom", e => g.attr("transform", e.transform));
                    svg.call(zoom);
                    
                    hierarchyRoot.children.forEach(child => child.children = null); // Start with all collapsed
                    updateGraph();
                }
            }
            
            function drag(simulation) {
                function dragstarted(event, d) { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; }
                function dragged(event, d) { d.fx = event.x; d.fy = event.y; }
                function dragended(event, d) { if (!event.active) simulation.alphaTarget(0); if (d.id !== ROOT_NODE_ID) { d.fx = null; d.fy = null; } }
                return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
            }

            function resetView() { if (svg && zoom) { svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity); } }
            
            function toggleAllNodes() {
                const shouldCollapseAll = hierarchyRoot.children.some(c => c.children);
                hierarchyRoot.children.forEach(child => { child.children = shouldCollapseAll ? null : (child._children || null); });
                updateGraph();
            }

            function generateListView() {
                let html = `<h1>${mindMapInfo[ROOT_NODE_ID].title}</h1>`;
                for (const catId in structure) {
                    if (mindMapInfo[catId]) {
                        html += `<h2 data-id="${catId}">${mindMapInfo[catId].title}</h2><ul>`;
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) { html += `<li data-id="${topicId}">${mindMapInfo[topicId].title}</li>`; }
                        });
                        html += '</ul>';
                    }
                }
                listViewContainer.innerHTML = html;
                listViewContainer.querySelectorAll('li, h2').forEach(item => {
                    item.addEventListener('click', () => {
                        openInfoModal(item.dataset.id);
                    });
                });
            }

            function toggleListView() {
                mindMapContainer.classList.toggle('hidden');
                listViewContainer.classList.toggle('hidden');
                document.getElementById('list-view-btn').classList.toggle('active');
                if (!listViewContainer.classList.contains('hidden') && listViewContainer.innerHTML === '') { generateListView(); }
            }
            
            function highlightNode(nodeId, doPan = true) {
                if (!node) return;
                node.classed("highlight", d => d.id === nodeId);
                if (doPan) {
                    const targetNode = simulation.nodes().find(n => n.id === nodeId);
                    if (targetNode && svg && zoom) {
                        const width = mindMapContainer.clientWidth;
                        const height = mindMapContainer.clientHeight;
                        const t = d3.zoomTransform(svg.node());
                        const transform = d3.zoomIdentity.translate(width / 2 - targetNode.x * t.k, height / 2 - targetNode.y * t.k).scale(t.k);
                        svg.transition().duration(500).call(zoom.transform, transform);
                    }
                }
            }
            
            function navigate(direction) {
                if (sequentialNavigableNodes.length === 0 || !mindMapContainer.classList.contains('hidden') === false) return;
                highlightedNodeIndex = (highlightedNodeIndex + direction + sequentialNavigableNodes.length) % sequentialNavigableNodes.length;
                const nextNode = sequentialNavigableNodes[highlightedNodeIndex];
                
                const parentId = Object.keys(structure).find(key => structure[key].includes(nextNode.id));
                const parentNode = hierarchyRoot.children.find(c => c.id === parentId);

                let needsUpdate = false;
                if (parentNode && !parentNode.children) {
                    parentNode.children = parentNode._children;
                    needsUpdate = true;
                }
                
                if (needsUpdate) { updateGraph(() => { highlightNode(nextNode.id); }); } 
                else { highlightNode(nextNode.id); }
            }

            // --- EVENT LISTENERS ---
            document.getElementById('close-modal-info').addEventListener('click', () => infoModal.classList.remove('active'));
            infoModal.addEventListener('click', (e) => e.target === infoModal && infoModal.classList.remove('active'));
            
            document.getElementById('close-modal-ai').addEventListener('click', () => aiModal.classList.remove('active'));
            aiModal.addEventListener('click', (e) => e.target === aiModal && aiModal.classList.remove('active'));

            themeToggleButton.addEventListener('click', () => {
                const isDark = document.body.classList.toggle('dark');
                themeIconLight.classList.toggle('hidden', isDark);
                themeIconDark.classList.toggle('hidden', !isDark);
            });

            document.getElementById('share-btn').addEventListener('click', () => {
                document.getElementById('share-url').value = window.location.href;
                shareModal.classList.add('active');
            });
            document.getElementById('close-modal-share').addEventListener('click', () => shareModal.classList.remove('active'));
            shareModal.addEventListener('click', (e) => e.target === shareModal && shareModal.classList.remove('active'));
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                const urlInput = document.getElementById('share-url');
                urlInput.select();
                try {
                    document.execCommand('copy');
                    const feedback = document.getElementById('copy-feedback');
                    feedback.textContent = 'Link copied!';
                    setTimeout(() => feedback.textContent = '', 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
            });

            window.addEventListener('resize', initializeGraph);
            menuToggleButton.addEventListener('click', () => toolbar.classList.toggle('expanded'));
            document.getElementById('home-btn').addEventListener('click', resetView);
            document.getElementById('toggle-all-btn').addEventListener('click', toggleAllNodes);
            document.getElementById('list-view-btn').addEventListener('click', toggleListView);
            document.getElementById('prev-btn').addEventListener('click', () => navigate(-1));
            document.getElementById('next-btn').addEventListener('click', () => navigate(1));
            
            window.addEventListener('keydown', (e) => {
                if (document.activeElement.tagName === 'INPUT' || infoModal.classList.contains('active') || shareModal.classList.contains('active') || aiModal.classList.contains('active')) return;
                if (e.key === 'ArrowRight') navigate(1);
                else if (e.key === 'ArrowLeft') navigate(-1);
            });

            initializeGraph();
        });
    </script>
</body>
</html>
