<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Interactive Mind Map: Engineering Statics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0KOVEMckDMOe6bvJOiFnO4IMUYLz3G92BIUKEp5nA7C8MFFKSSJTI" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-light: #f8fafc; --bg-dark: #0b1120;
            --node-bg-light: #ffffff; --node-bg-dark: #1e293b;
            --text-light: #1e293b; --text-dark: #e2e8f0;
            --border-light: #cbd5e1; --border-dark: #475569;
            --link-light: #94a3b8; --link-dark: #64748b;
            --primary-light: #3b82f6; --primary-dark: #60a5fa;
            --primary-text-light: #ffffff; --primary-text-dark: #0b1120;
            --highlight-border-light: #ef4444; /* Red-500 */
            --highlight-border-dark: #f87171; /* Red-400 */
            
            --cat-bg-expanded-light: #e0e7ff; --cat-border-expanded-light: #a5b4fc; --cat-text-expanded-light: #3730a3;
            --cat-bg-collapsed-light: #e5e7eb; --cat-border-collapsed-light: #9ca3af; --cat-text-collapsed-light: #4b5563;
            --cat-bg-expanded-dark: #312e81; --cat-border-expanded-dark: #818cf8; --cat-text-expanded-dark: #e0e7ff;
            --cat-bg-collapsed-dark: #374151; --cat-border-collapsed-dark: #6b7280; --cat-text-collapsed-dark: #d1d5db;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Inter', sans-serif;
            background-color: var(--bg-light); transition: background-color 0.3s ease;
        }
        body.dark { background-color: var(--bg-dark); }
        #mind-map-container, #list-view-container { width: 100%; height: 100%; position: relative; box-sizing: border-box; }
        #mind-map-container { cursor: grab; }
        #mind-map-container:active { cursor: grabbing; }

        .node { cursor: pointer; }
        .node rect {
            stroke-width: 2.5px; rx: 8; ry: 8;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
            transition: fill 0.3s ease, stroke 0.3s ease, transform 0.2s ease, stroke-width 0.2s ease;
        }
        .node:hover rect { transform: scale(1.05); }
        .node text { pointer-events: none; text-anchor: middle; dominant-baseline: central; font-weight: 500; transition: fill 0.3s ease; }
        .link { stroke-opacity: 0.7; transition: stroke 0.3s ease; }
        .katex { font-size: 1.1em; }

        .node.level-0 rect { fill: var(--primary-light); stroke: var(--primary-light); }
        .node.level-0 text { fill: var(--primary-text-light); font-size: 16px; font-weight: 700; }
        .node.level-1 rect { fill: var(--cat-bg-expanded-light); stroke: var(--cat-border-expanded-light); }
        .node.level-1 text { fill: var(--cat-text-expanded-light); font-size: 14px; font-weight: 600; }
        .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-light); stroke: var(--cat-border-collapsed-light); }
        .node.level-1.collapsed text { fill: var(--cat-text-collapsed-light); }
        .node.level-2 rect { fill: var(--node-bg-light); stroke: var(--border-light); }
        .node.level-2 text { fill: var(--text-light); font-size: 12px; }
        .link { stroke: var(--link-light); }
        
        body.dark .node.level-0 rect { fill: var(--primary-dark); stroke: var(--primary-dark); }
        body.dark .node.level-0 text { fill: var(--primary-text-dark); }
        body.dark .node.level-1 rect { fill: var(--cat-bg-expanded-dark); stroke: var(--cat-border-expanded-dark); }
        body.dark .node.level-1 text { fill: var(--cat-text-expanded-dark); }
        body.dark .node.level-1.collapsed rect { fill: var(--cat-bg-collapsed-dark); stroke: var(--cat-border-collapsed-dark); }
        body.dark .node.level-1.collapsed text { fill: var(--cat-text-collapsed-dark); }
        body.dark .node.level-2 rect { fill: var(--node-bg-dark); stroke: var(--border-dark); }
        body.dark .node.level-2 text { fill: var(--text-dark); }
        body.dark .link { stroke: var(--link-dark); }

        .node.highlight rect { stroke: var(--highlight-border-light); stroke-width: 4px; }
        body.dark .node.highlight rect { stroke: var(--highlight-border-dark); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--node-bg-light); color: var(--text-light); padding: 1.5rem; border-radius: 0.75rem; max-width: 90%; width: 600px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal-overlay.active .modal-content { transform: scale(1); }
        body.dark .modal-content { background: var(--node-bg-dark); color: var(--text-dark); }
        .modal-content h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark .modal-content h2 { color: var(--primary-dark); }
        .modal-content h3 { font-size: 1.15rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-light); }
        body.dark .modal-content h3 { color: var(--primary-dark); }
        .modal-content ul { padding-left: 1.5rem; margin-top: 0.5rem; }
        .modal-content li { margin-bottom: 0.25rem; }
        .modal-content code { background-color: #e2e8f0; color: #1e293b; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; }
        body.dark .modal-content code { background-color: #475569; color: #e2e8f0; }

        #toolbar { position: fixed; z-index: 500; top: 50%; right: 1rem; transform: translateY(-50%); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
        #toolbar.expanded { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(200, 200, 200, 0.5); border-radius: 9999px; padding: 0.5rem; }
        body.dark #toolbar.expanded { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(71, 85, 105, 0.5); }
        #toolbar-tools { display: flex; flex-direction: column; gap: 0.5rem; max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.25, 1, 0.5, 1), padding 0.5s ease; }
        #toolbar.expanded #toolbar-tools { max-height: 500px; }
        .toolbar-divider { width: 80%; height: 1px; margin: 0.25rem auto; background-color: #e2e8f0; }
        body.dark .toolbar-divider { background-color: #475569; }

        #list-view-container { padding: 2rem; overflow-y: auto; background-color: var(--bg-light); color: var(--text-light); box-sizing: border-box; height: 100%; }
        body.dark #list-view-container { background-color: var(--bg-dark); color: var(--text-dark); }
        #list-view-container h1 { font-size: 2rem; font-weight: bold; margin-bottom: 1rem; color: var(--primary-light); }
        body.dark #list-view-container h1 { color: var(--primary-dark); }
        #list-view-container h2 { font-size: 1.5rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 2px solid var(--border-light); padding-bottom: 0.5rem; }
        body.dark #list-view-container h2 { border-bottom-color: var(--border-dark); }
        #list-view-container ul { list-style: none; padding-left: 1rem; }
        #list-view-container li { padding: 0.5rem; margin: 0.25rem 0; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; }
        #list-view-container li:hover { background-color: rgba(0,0,0,0.05); }
        body.dark #list-view-container li:hover { background-color: rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div id="mind-map-container"></div>
    <div id="list-view-container" class="hidden"></div>

    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modal-title"></h2>
                <button id="close-modal-info" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <div id="share-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">Share Mind Map</h2>
                <button id="close-modal-share" class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 text-3xl">&times;</button>
            </div>
            <div class="space-y-4">
                <p class="text-sm text-gray-600 dark:text-gray-400">Share this interactive mind map with others!</p>
                <div class="relative">
                    <input id="share-url" type="text" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700" readonly>
                    <button id="copy-link-btn" class="absolute right-1 top-1/2 -translate-y-1/2 p-2 bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    </button>
                </div>
                <p id="copy-feedback" class="text-sm text-green-600 dark:text-green-400 h-4 text-center"></p>
            </div>
        </div>
    </div>

    <div id="toolbar">
        <button id="menu-toggle-btn" title="Toggle Menu" class="p-3 rounded-full bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
        <div id="toolbar-tools">
            <button id="home-btn" title="Reset View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            </button>
            <button id="toggle-all-btn" title="Expand/Collapse All" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4h4m12 4V4h-4M4 16v4h4m12-4v4h-4" /></svg>
            </button>
            <button id="list-view-btn" title="List View" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="prev-btn" title="Previous Topic (Left Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="next-btn" title="Next Topic (Right Arrow)" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button id="share-btn" title="Share" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" /></svg>
            </button>
            <button id="theme-toggle" title="Toggle Dark Mode" class="p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700 dark:text-gray-300 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ========= DYNAMIC CONTENT SECTION START =========
            const ROOT_NODE_ID = 'engineering_statics';

            const mindMapInfo = {
                engineering_statics: {
                    title: "Engineering Statics",
                    content: `
                        <p>Statics is the branch of mechanics that is concerned with the analysis of loads (force and torque, or 'moment') on physical systems in static equilibrium, that is, in a state where the relative positions of subsystems do not vary over time, or where components and structures are at a constant velocity.</p>
                        <h3>How to Use This Mind Map</h3>
                        <ul>
                            <li><strong>Click Nodes:</strong> Click a category to expand/collapse. Click a concept for details or to open its link.</li>
                            <li><strong>Pan & Zoom:</strong> Drag the background to pan. Use your mouse wheel to zoom.</li>
                            <li><strong>Toolbar:</strong> Use the floating toolbar for more options:
                                <ul>
                                    <li><strong>Reset View:</strong> Centers the map.</li>
                                    <li><strong>Expand/Collapse All:</strong> Toggles all categories.</li>
                                    <li><strong>List View:</strong> Switches to a text-based view.</li>
                                    <li><strong>Navigate:</strong> Use arrows to cycle through topics.</li>
                                    <li><strong>Share:</strong> Get a link to share the map.</li>
                                    <li><strong>Theme:</strong> Switch between light/dark modes.</li>
                                </ul>
                            </li>
                        </ul>`,
                    keywords: "statics, mechanics, engineering, equilibrium"
                },
                fundamental_concepts: {
                    title: "Fundamental Concepts",
                    content: "<p>The basic principles and definitions that form the foundation of statics.</p>",
                    keywords: "basics, principles, foundation"
                },
                newtons_laws: {
                    title: "Newton's Laws",
                    content: `<h3>Newton's Laws of Motion</h3>
                                    <p>While statics deals with objects at rest, Newton's laws are the foundation upon which all of mechanics is built.</p>
                                    <ul>
                                        <li><strong>First Law (Inertia):</strong> An object at rest stays at rest and an object in motion stays in motion with the same speed and in the same direction unless acted upon by an unbalanced force.</li>
                                        <li><strong>Second Law (Acceleration):</strong> The acceleration of an object is dependent upon two variables - the net force acting upon the object and the mass of the object. The foundation for dynamics. $$ \\sum \\vec{F} = m\\vec{a} $$</li>
                                        <li><strong>Third Law (Action-Reaction):</strong> For every action, there is an equal and opposite reaction.</li>
                                    </ul>`,
                    keywords: "newton, inertia, action, reaction, force, mass"
                },
                vectors_and_scalars: {
                    title: "Vectors & Scalars",
                    content: `<h3>Vectors and Scalars</h3>
                                    <p>Physical quantities are categorized as either scalars or vectors.</p>
                                    <ul>
                                        <li><strong>Scalar:</strong> A quantity that is fully described by a magnitude only. Examples: mass, temperature, time.</li>
                                        <li><strong>Vector:</strong> A quantity that has both a magnitude and a direction. Examples: force, velocity, displacement. Vectors are represented by arrows and can be resolved into components (e.g., $F_x, F_y$).</li>
                                    </ul>`,
                    keywords: "vector, scalar, magnitude, direction, component"
                },
                units_and_dimensions: {
                    title: "Units & Dimensions",
                    content: `<h3>Units and Dimensions</h3>
                                    <p>Consistency in units is crucial for solving engineering problems.</p>
                                    <ul>
                                        <li><strong>SI Units (International System):</strong> The modern form of the metric system. Base units include the meter (m) for length, kilogram (kg) for mass, and second (s) for time. Force is a derived unit, the Newton (N), where $1 \\text{ N} = 1 \\text{ kg} \\cdot \\text{m/s}^2$.</li>
                                        <li><strong>US Customary Units:</strong> Units include the foot (ft) for length, slug for mass, and pound (lb) for force.</li>
                                    </ul>`,
                    keywords: "si, us customary, units, newton, pound, meter, foot"
                },
                free_body_diagrams: {
                    title: "Free Body Diagrams (FBD)",
                    content: `<h3>Free Body Diagrams</h3>
                                    <p>A Free Body Diagram (FBD) is a graphical illustration used to visualize the applied forces, moments, and resulting reactions on a body in a given condition. It is the single most important step in solving statics problems.</p>
                                    <p><strong>Steps:</strong></p>
                                    <ol>
                                        <li>Isolate the body of interest.</li>
                                        <li>Draw all external forces acting ON the body (applied loads, support reactions, weight).</li>
                                        <li>Label all forces and specify directions.</li>
                                    </ol>`,
                    keywords: "fbd, free body diagram, forces, reactions"
                },
                force_systems: {
                    title: "Force Systems",
                    content: "<p>Analyzing and simplifying systems of forces and moments acting on a body.</p>",
                    keywords: "force, moment, couple, resultant"
                },
                concurrent_forces: {
                    title: "Concurrent Forces",
                    content: `<h3>Concurrent Forces</h3>
                                    <p>A system of forces where all the lines of action intersect at a single point. The resultant of a concurrent force system is a single force passing through the point of concurrency. There is no moment about the point of concurrency.</p>`,
                    keywords: "concurrent, intersect, point"
                },
                coplanar_forces: {
                    title: "Coplanar Forces",
                    content: `<h3>Coplanar Forces</h3>
                                    <p>A system of forces where all the forces lie in the same plane. Problems are typically 2D, involving x and y components.</p>`,
                    keywords: "coplanar, 2d, plane"
                },
                moment_of_a_force: {
                    title: "Moment of a Force",
                    content: `<h3>Moment of a Force (Torque)</h3>
                                    <p>The tendency of a force to cause rotation about a point or axis. The moment $M_O$ of a force $\\vec{F}$ about a point O is a vector quantity defined by the cross product:</p>
                                    $$ \\vec{M}_O = \\vec{r} \\times \\vec{F} $$
                                    <p>Where $\\vec{r}$ is the position vector from point O to any point on the line of action of $\\vec{F}$. The magnitude is $M_O = Fd$, where $d$ is the perpendicular distance (moment arm).</p>
                                    <h3>Varignon's Theorem</h3>
                                    <p>The moment of a force about a point is equal to the sum of the moments of its components about the same point.</p>`,
                    keywords: "moment, torque, varignon, cross product, arm"
                },
                couples: {
                    title: "Couples",
                    content: `<h3>Couples</h3>
                                    <p>A couple consists of two parallel forces that are equal in magnitude, opposite in direction, and do not share a line of action. A couple produces a pure rotation, or moment, that is independent of the point about which it is calculated. The moment of a couple is given by:</p>
                                    $$ M = Fd $$
                                    <p>Where $d$ is the perpendicular distance between the two forces.</p>`,
                    keywords: "couple, pure moment, rotation"
                },
                resultants: {
                    title: "Resultants",
                    content: `<h3>Resultants</h3>
                                    <p>The process of finding a single force and/or couple moment that has the same external effect on a body as the original system of forces. This is the simplest equivalent system.</p>
                                    <p>For a general force system, the resultant force $\\vec{F}_R$ and resultant moment $\\vec{M}_{R_O}$ are:</p>
                                    $$ \\vec{F}_R = \\sum \\vec{F} $$
                                    $$ \\vec{M}_{R_O} = \\sum (\\vec{r} \\times \\vec{F}) + \\sum \\vec{M}_C $$`,
                    keywords: "resultant, equivalent system, simplification"
                },
                equilibrium: {
                    title: "Equilibrium",
                    content: "<p>The state where a body is at rest because the net force and net moment acting on it are zero.</p>",
                    keywords: "equilibrium, balance, rest"
                },
                equilibrium_of_a_particle: {
                    title: "Equilibrium of a Particle",
                    content: `<h3>Equilibrium of a Particle</h3>
                                    <p>A particle is in equilibrium if the vector sum of all forces acting on it is zero. Particles are idealized as single points, so moments are not considered.</p>
                                    $$ \\sum \\vec{F} = 0 $$
                                    <p>In 2D, this resolves to two scalar equations:</p>
                                    $$ \\sum F_x = 0 \\quad \\text{and} \\quad \\sum F_y = 0 $$`,
                    keywords: "particle, equilibrium, sum of forces"
                },
                equilibrium_of_a_rigid_body: {
                    title: "Equilibrium of a Rigid Body",
                    content: `<h3>Equilibrium of a Rigid Body</h3>
                                    <p>A rigid body is in equilibrium if the vector sum of all external forces is zero, AND the vector sum of all moments about any arbitrary point is zero.</p>
                                    $$ \\sum \\vec{F} = 0 $$
                                    $$ \\sum \\vec{M}_O = 0 $$
                                    <p>In 2D, this resolves to three scalar equations:</p>
                                    $$ \\sum F_x = 0, \\quad \\sum F_y = 0, \\quad \\sum M_O = 0 $$`,
                    keywords: "rigid body, equilibrium, sum of forces, sum of moments"
                },
                two_and_three_force_members: {
                    title: "Two- & Three-Force Members",
                    content: `<h3>Two- & Three-Force Members</h3>
                                    <p>Simplifications for analyzing equilibrium.</p>
                                    <ul>
                                        <li><strong>Two-Force Member:</strong> A member subjected to forces at only two points. For equilibrium, the two forces must be equal, opposite, and collinear.</li>
                                        <li><strong>Three-Force Member:</strong> A member subjected to forces at three points. For equilibrium, the lines of action of the three forces must be concurrent (intersect at a single point) or parallel.</li>
                                    </ul>`,
                    keywords: "two-force, three-force, member, concurrent"
                },
                structural_analysis: {
                    title: "Structural Analysis",
                    content: "<p>Methods for determining the forces in members of structures like trusses, frames, and machines.</p>",
                    keywords: "truss, frame, machine, structure"
                },
                method_of_joints: {
                    title: "Method of Joints",
                    content: `<h3>Method of Joints</h3>
                                    <p>A method for finding the forces in members of a truss. It involves applying the equations of equilibrium ($ \\sum F_x = 0, \\sum F_y = 0 $) to each joint of the truss, treating each joint as a particle in equilibrium under the influence of the connected members and any external loads.</p>
                                    <p>It is most efficient when you need to find the forces in all members of the truss.</p>`,
                    keywords: "truss, method of joints, joint equilibrium"
                },
                method_of_sections: {
                    title: "Method of Sections",
                    content: `<h3>Method of Sections</h3>
                                    <p>A method for finding forces in specific members of a truss. It involves cutting the truss into two sections through the members whose forces are desired. The equations of equilibrium ($ \\sum F_x = 0, \\sum F_y = 0, \\sum M_O = 0 $) are then applied to one of the sections, treating it as a rigid body.</p>
                                    <p>It is most efficient for finding forces in a few specific members.</p>`,
                    keywords: "truss, method of sections, cut, section"
                },
                frames_and_machines: {
                    title: "Frames and Machines",
                    content: `<h3>Frames and Machines</h3>
                                    <p>Structures that contain at least one multi-force member (a member with forces at three or more points).</p>
                                    <ul>
                                        <li><strong>Frames:</strong> Designed to support loads and are usually stationary.</li>
                                        <li><strong>Machines:</strong> Designed to transmit and modify forces, and typically have moving parts.</li>
                                    </ul>
                                    <p>Analysis involves disassembling the structure and drawing a Free Body Diagram for each member.</p>`,
                    keywords: "frames, machines, multi-force member"
                },
                internal_forces: {
                    title: "Internal Forces",
                    content: "<p>Analysis of the forces and moments acting within a structural member, such as a beam.</p>",
                    keywords: "internal, shear, moment, beam"
                },
                shear_and_moment_diagrams: {
                    title: "Shear & Moment Diagrams",
                    content: `<h3>Shear and Moment Diagrams</h3>
                                    <p>Graphical representations of the internal shear force (V) and bending moment (M) along the length of a beam.</p>
                                    <ul>
                                        <li><strong>Shear Diagram (V):</strong> Plots the internal shear force versus position along the beam.</li>
                                        <li><strong>Moment Diagram (M):</strong> Plots the internal bending moment versus position along the beam.</li>
                                    </ul>
                                    <p>These diagrams are critical for design, as they show the locations and magnitudes of maximum shear and moment.</p>`,
                    keywords: "shear diagram, moment diagram, V, M, beam"
                },
                relations_load_shear_moment: {
                    title: "Load, Shear & Moment Relations",
                    content: `<h3>Relationships between Load, Shear, and Moment</h3>
                                    <p>Differential and integral relationships that simplify the construction of shear and moment diagrams.</p>
                                    <ul>
                                        <li>The slope of the shear diagram at any point is equal to the intensity of the distributed load $w(x)$ at that point: $$ \\frac{dV}{dx} = -w(x) $$</li>
                                        <li>The slope of the moment diagram at any point is equal to the shear force at that point: $$ \\frac{dM}{dx} = V(x) $$</li>
                                        <li>The change in shear between two points is the area under the load diagram between those points.</li>
                                        <li>The change in moment between two points is the area under the shear diagram between those points.</li>
                                    </ul>`,
                    keywords: "load, shear, moment, derivative, integral, area"
                },
                friction: {
                    title: "Friction",
                    content: "<p>The force resisting the relative motion between surfaces in contact.</p>",
                    keywords: "friction, contact, motion"
                },
                dry_friction: {
                    title: "Dry Friction (Coulomb Friction)",
                    content: `<h3>Dry Friction</h3>
                                    <p>Friction between two solid surfaces in contact, in the absence of a lubricating fluid.</p>
                                    <ul>
                                        <li><strong>Static Friction ($F_s$):</strong> The friction force that prevents motion. It has a maximum value: $$ F_s \\le \\mu_s N $$ where $\\mu_s$ is the coefficient of static friction and $N$ is the normal force.</li>
                                        <li><strong>Kinetic Friction ($F_k$):</strong> The friction force that opposes motion once it has started. It has a constant magnitude: $$ F_k = \\mu_k N $$ where $\\mu_k$ is the coefficient of kinetic friction. Typically, $\\mu_k < \\mu_s$.</li>
                                    </ul>`,
                    keywords: "dry friction, static, kinetic, coulomb, coefficient"
                },
                wedges: {
                    title: "Wedges",
                    content: `<h3>Wedges</h3>
                                    <p>Simple machines used to transform an applied force into much larger forces, generally at right angles to the applied force. Analysis involves applying friction forces at all contact surfaces and using the equations of equilibrium.</p>`,
                    keywords: "wedge, simple machine, friction"
                },
                screws: {
                    title: "Screws",
                    content: `<h3>Screws</h3>
                                    <p>Screws are used as fasteners or for transmitting power or motion. The analysis of a square-threaded screw is similar to analyzing a block on an inclined plane, where the incline is related to the screw's lead angle.</p>`,
                    keywords: "screw, thread, lead angle, friction"
                },
                bearings_and_belts: {
                    title: "Bearings & Belts",
                    content: `<h3>Friction in Bearings and Belts</h3>
                                    <ul>
                                        <li><strong>Axle/Journal Bearings:</strong> Friction creates a resisting moment that opposes the rotation of the axle.</li>
                                        <li><strong>Thrust Bearings:</strong> Friction occurs over the circular contact area, creating a resisting moment.</li>
                                        <li><strong>Belt Friction:</strong> The difference in tension in a flexible belt wrapped around a pulley is related to the coefficient of friction and the angle of wrap. For impending slip: $$ \\frac{T_2}{T_1} = e^{\\mu \\beta} $$</li>
                                    </ul>`,
                    keywords: "bearing, belt, axle, tension, friction"
                },
                center_of_mass_and_centroids: {
                    title: "Center of Mass & Centroids",
                    content: "<p>Determining the geometric center of objects, which is critical for analyzing distributed loads and body behavior.</p>",
                    keywords: "centroid, center of mass, center of gravity"
                },
                center_of_gmc: {
                    title: "Center of Gravity, Mass, & Centroid",
                    content: `<h3>Center of Gravity, Mass, and Centroid</h3>
                                    <ul>
                                        <li><strong>Center of Gravity (G):</strong> The point where the total weight of a body can be considered to act.</li>
                                        <li><strong>Center of Mass:</strong> The point where the total mass of a body can be considered to be concentrated. In a uniform gravitational field, this is the same as the center of gravity.</li>
                                        <li><strong>Centroid (C):</strong> The geometric center of a shape (volume, area, or line). For a body with uniform density, the centroid coincides with the center of mass.</li>
                                    </ul>
                                    <p>The centroid coordinates $(\\bar{x}, \\bar{y})$ for an area are found by integrating over the area A, where $(\\tilde{x}, \\tilde{y})$ are the coordinates of the centroid of the differential area element $dA$:</p>
                                    $$ \\bar{x} = \\frac{\\int_A \\tilde{x} \\, dA}{\\int_A dA} \\quad \\text{and} \\quad \\bar{y} = \\frac{\\int_A \\tilde{y} \\, dA}{\\int_A dA} $$`,
                    keywords: "center of gravity, center of mass, centroid, integral"
                },
                composite_bodies: {
                    title: "Composite Bodies",
                    content: `<h3>Composite Bodies</h3>
                                    <p>A method for finding the centroid of a complex shape by dividing it into simpler, common shapes (rectangles, triangles, circles, etc.). The overall centroid is found by taking a weighted average of the individual centroids, where $\\tilde{x}_i$ and $\\tilde{y}_i$ are the centroidal coordinates of each simple shape $A_i$.</p>
                                    $$ \\bar{X} = \\frac{\\sum_i \\tilde{x}_i A_i}{\\sum_i A_i} \\quad \\text{and} \\quad \\bar{Y} = \\frac{\\sum_i \\tilde{y}_i A_i}{\\sum_i A_i} $$`,
                    keywords: "composite body, weighted average, centroid"
                },
                theorems_of_pappus_guldinus: {
                    title: "Theorems of Pappus-Guldinus",
                    content: `<h3>Theorems of Pappus-Guldinus</h3>
                                    <p>Two theorems relating surfaces and volumes of revolution to the centroid of the generating curve or area.</p>
                                    <ul>
                                        <li><strong>First Theorem (Surface Area):</strong> The surface area generated by revolving a plane curve about a non-intersecting axis is equal to the product of the length of the curve and the distance traveled by its centroid. $$ A = 2\\pi \\bar{y} L $$</li>
                                        <li><strong>Second Theorem (Volume):</strong> The volume generated by revolving a plane area about a non-intersecting axis is equal to the product of the area and the distance traveled by its centroid. $$ V = 2\\pi \\bar{y} A $$</li>
                                    </ul>`,
                    keywords: "pappus, guldinus, revolution, surface area, volume"
                },
                moments_of_inertia: {
                    title: "Moments of Inertia",
                    content: "<p>A measure of a body's resistance to rotational motion or bending.</p>",
                    keywords: "moment of inertia, area, mass, rotation"
                },
                area_moment_of_inertia: {
                    title: "Area Moment of Inertia",
                    content: `<h3>Area Moment of Inertia</h3>
                                    <p>A property of a 2D plane shape which characterizes its resistance to bending. It is a purely geometric property.</p>
                                    $$ I_x = \\int_A y^2 \\, dA $$
                                    $$ I_y = \\int_A x^2 \\, dA $$
                                    <p>The <strong>Polar Moment of Inertia</strong>, $J_O$, characterizes resistance to torsion:</p>
                                    $$ J_O = \\int_A r^2 \\, dA = I_x + I_y $$`,
                    keywords: "area moment of inertia, bending, second moment of area, polar"
                },
                parallel_axis_theorem: {
                    title: "Parallel-Axis Theorem",
                    content: `<h3>Parallel-Axis Theorem</h3>
                                    <p>A theorem used to determine the moment of inertia of a rigid body or plane shape about any axis, given its moment of inertia about a parallel axis through its own centroid.</p>
                                    <p>For an area:</p>
                                    $$ I_x = I_{\\bar{x}} + A d_y^2 $$
                                    $$ I_y = I_{\\bar{y}} + A d_x^2 $$
                                    <p>Where $I_{\\bar{x}}$ is the moment of inertia about the centroidal x-axis and $d_y$ is the perpendicular distance between the x and $\\bar{x}$ axes.</p>`,
                    keywords: "parallel axis theorem, moment of inertia, centroid"
                },
                mass_moment_of_inertia: {
                    title: "Mass Moment of Inertia",
                    content: `<h3>Mass Moment of Inertia</h3>
                                    <p>A measure of an object's resistance to angular acceleration. It is the rotational analog of mass.</p>
                                    $$ I = \\int_m r^2 \\, dm $$
                                    <p>It depends on the mass of the body and its distribution relative to the axis of rotation.</p>`,
                    keywords: "mass moment of inertia, angular acceleration, rotation"
                }
            };

            const structure = {
                fundamental_concepts: ['newtons_laws', 'vectors_and_scalars', 'units_and_dimensions', 'free_body_diagrams'],
                force_systems: ['concurrent_forces', 'coplanar_forces', 'moment_of_a_force', 'couples', 'resultants'],
                equilibrium: ['equilibrium_of_a_particle', 'equilibrium_of_a_rigid_body', 'two_and_three_force_members'],
                structural_analysis: ['method_of_joints', 'method_of_sections', 'frames_and_machines'],
                internal_forces: ['shear_and_moment_diagrams', 'relations_load_shear_moment'],
                friction: ['dry_friction', 'wedges', 'screws', 'bearings_and_belts'],
                center_of_mass_and_centroids: ['center_of_gmc', 'composite_bodies', 'theorems_of_pappus_guldinus'],
                moments_of_inertia: ['area_moment_of_inertia', 'parallel_axis_theorem', 'mass_moment_of_inertia']
            };
            // ========= DYNAMIC CONTENT SECTION END =========


            // --- CORE LOGIC (DO NOT EDIT) ---
            const hierarchyRoot = { id: ROOT_NODE_ID, level: 0, children: [] };
            for (const catId in structure) {
                if (mindMapInfo[catId]) {
                    const categoryNode = { id: catId, level: 1, _children: [] };
                    hierarchyRoot.children.push(categoryNode);
                    if (structure[catId] && structure[catId].length > 0) {
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) {
                                categoryNode._children.push({ id: topicId, level: 2 });
                            }
                        });
                    }
                }
            }
            
            const mindMapContainer = document.getElementById('mind-map-container');
            const listViewContainer = document.getElementById('list-view-container');
            const infoModal = document.getElementById('info-modal');
            const shareModal = document.getElementById('share-modal');
            const themeToggleButton = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const menuToggleButton = document.getElementById('menu-toggle-btn');
            const toolbar = document.getElementById('toolbar');
            
            let simulation, svg, g, linkGroup, nodeGroup, link, node, zoom;
            let sequentialNavigableNodes = [];
            let highlightedNodeIndex = -1;

            function getVisibleNodesAndLinks(root) {
                const visibleNodes = [], visibleLinks = [];
                function recurse(node) {
                    if (!node) return;
                    visibleNodes.push(node);
                    if (node.children) {
                        node.children.forEach(child => {
                            visibleLinks.push({ source: node, target: child });
                            recurse(child);
                        });
                    }
                }
                recurse(root);
                return { nodes: visibleNodes, links: visibleLinks };
            }

            function updateGraph(callback) {
                const { nodes: currentNodes, links: currentLinks } = getVisibleNodesAndLinks(hierarchyRoot);
                const tempSvg = d3.select(document.body).append("svg").attr("class", "absolute -left-full");
                currentNodes.forEach(n => {
                    const textEl = tempSvg.append("text")
                        .attr("class", `node level-${n.level}`)
                        .style("font-size", n.level === 0 ? "16px" : n.level === 1 ? "14px" : "12px")
                        .style("font-weight", n.level < 2 ? "700" : "500")
                        .text(mindMapInfo[n.id].title);
                    const bbox = textEl.node().getBBox();
                    n.width = bbox.width + (n.level === 1 ? 40 : 30);
                    n.height = bbox.height + 20;
                });
                tempSvg.remove();

                node = nodeGroup.selectAll(".node").data(currentNodes, d => d.id)
                    .join(
                        enter => {
                            const nodeEnter = enter.append("g")
                                .attr("class", d => `node level-${d.level}`)
                                .call(drag(simulation))
                                .on("click", handleNodeClick);
                            nodeEnter.append("rect");
                            nodeEnter.append("text");
                            return nodeEnter;
                        },
                        update => update,
                        exit => exit.transition().duration(300).attr("transform", "scale(0)").remove()
                    );
                
                node.classed("collapsed", d => d._children && !d.children);
                node.select("rect").transition().duration(300)
                    .attr("width", d => d.width).attr("height", d => d.height)
                    .attr("x", d => -d.width / 2).attr("y", d => -d.height / 2);
                node.select("text").text(d => mindMapInfo[d.id].title);

                link = linkGroup.selectAll(".link").data(currentLinks, d => `${d.source.id}-${d.target.id}`)
                    .join(
                        enter => enter.append("line").attr("class", "link").attr("stroke-opacity", 0),
                        update => update,
                        exit => exit.transition().duration(300).attr("stroke-opacity", 0).remove()
                    );
                link.transition().duration(300).attr("stroke-opacity", 0.7);

                simulation.nodes(currentNodes);
                simulation.force("link").links(currentLinks);
                simulation.alpha(0.8).restart();

                if (callback) {
                    const cb = () => {
                        callback();
                        simulation.on('end.callback', null);
                    };
                    simulation.on('end.callback', cb);
                }
            }

            function openInfoModal(nodeId) {
                const data = mindMapInfo[nodeId];
                if (data && data.content) {
                    document.getElementById('modal-title').innerHTML = data.title;
                    const modalBody = document.getElementById('modal-body');
                    modalBody.innerHTML = data.content;
                    if (window.renderMathInElement) {
                        window.renderMathInElement(modalBody, {
                            delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false} ],
                            throwOnError: false
                        });
                    }
                    infoModal.classList.add('active');
                }
            }

            function handleNodeClick(event, d) {
                if (event.defaultPrevented) return;
                const nodeInfo = mindMapInfo[d.id];
                highlightNode(d.id, false);

                if (nodeInfo.url) {
                    window.open(nodeInfo.url, '_blank');
                    highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === d.id);
                    return;
                }

                if (d.id === ROOT_NODE_ID) {
                    toggleAllNodes();
                } else if (d._children && d._children.length > 0) {
                    d.children = d.children ? null : d._children;
                    updateGraph();
                } else if (nodeInfo.content) {
                    openInfoModal(d.id);
                    highlightedNodeIndex = sequentialNavigableNodes.findIndex(n => n.id === d.id);
                }
            }

            function initializeGraph() {
                sequentialNavigableNodes = [];
                Object.values(structure).forEach(chapter => {
                    chapter.forEach(topicId => {
                        const nodeData = hierarchyRoot.children.flatMap(c => c._children || []).find(n => n.id === topicId);
                        if(nodeData) sequentialNavigableNodes.push(nodeData);
                    });
                });

                if (listViewContainer.classList.contains('hidden')) {
                    const width = mindMapContainer.clientWidth;
                    const height = mindMapContainer.clientHeight;
                    d3.select(mindMapContainer).select("svg").remove();
                    svg = d3.select(mindMapContainer).append("svg").attr("viewBox", [0, 0, width, height]);
                    g = svg.append("g");
                    linkGroup = g.append("g").attr("class", "links");
                    nodeGroup = g.append("g").attr("class", "nodes");
                    simulation = d3.forceSimulation()
                        .force("link", d3.forceLink().id(d => d.id).distance(d => (d.source.level === 0 ? 200 : 120)).strength(0.9))
                        .force("charge", d3.forceManyBody().strength(-800))
                        .force("center", d3.forceCenter(width / 2, height / 2))
                        .force("collide", d3.forceCollide().radius(d => d.width / 2 + 15).strength(1))
                        .on("tick", () => {
                            if(link) link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
                            if(node) node.attr("transform", d => `translate(${d.x},${d.y})`);
                        });
                    zoom = d3.zoom().scaleExtent([0.1, 3]).on("zoom", e => g.attr("transform", e.transform));
                    svg.call(zoom);
                    hierarchyRoot.children.forEach(child => child.children = null);
                    updateGraph();
                }
            }
            
            function drag(simulation) {
                function dragstarted(event, d) { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; }
                function dragged(event, d) { d.fx = event.x; d.fy = event.y; }
                function dragended(event, d) { if (!event.active) simulation.alphaTarget(0); if (d.id !== ROOT_NODE_ID) { d.fx = null; d.fy = null; } }
                return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
            }

            function resetView() { if (svg && zoom) { svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity); } }
            function toggleAllNodes() {
                const shouldCollapseAll = hierarchyRoot.children.some(c => c.children);
                hierarchyRoot.children.forEach(child => { child.children = shouldCollapseAll ? null : (child._children || null); });
                updateGraph();
            }

            function generateListView() {
                let html = `<h1>${mindMapInfo[ROOT_NODE_ID].title}</h1>`;
                for (const catId in structure) {
                    if (mindMapInfo[catId]) {
                        html += `<h2 data-id="${catId}">${mindMapInfo[catId].title}</h2><ul>`;
                        structure[catId].forEach(topicId => {
                            if (mindMapInfo[topicId]) { html += `<li data-id="${topicId}">${mindMapInfo[topicId].title}</li>`; }
                        });
                        html += '</ul>';
                    }
                }
                listViewContainer.innerHTML = html;
                listViewContainer.querySelectorAll('li, h2').forEach(item => {
                    item.addEventListener('click', () => {
                        const info = mindMapInfo[item.dataset.id];
                        if (info.url) { window.open(info.url, '_blank'); } 
                        else if (info.content) { openInfoModal(item.dataset.id); }
                    });
                });
            }

            function toggleListView() {
                mindMapContainer.classList.toggle('hidden');
                listViewContainer.classList.toggle('hidden');
                if (!listViewContainer.classList.contains('hidden') && listViewContainer.innerHTML === '') { generateListView(); }
            }
            
            function highlightNode(nodeId, doPan = true) {
                if (!node) return;
                node.classed("highlight", d => d.id === nodeId);
                if (doPan) {
                    const targetNode = simulation.nodes().find(n => n.id === nodeId);
                    if (targetNode && svg && zoom) {
                        const width = mindMapContainer.clientWidth;
                        const height = mindMapContainer.clientHeight;
                        const t = d3.zoomTransform(svg.node());
                        const transform = d3.zoomIdentity.translate(width / 2 - targetNode.x * t.k, height / 2 - targetNode.y * t.k).scale(t.k);
                        svg.transition().duration(500).call(zoom.transform, transform);
                    }
                }
            }
            
            function navigate(direction) {
                if (sequentialNavigableNodes.length === 0 || listViewContainer.classList.contains('hidden') === false) return;
                highlightedNodeIndex = (highlightedNodeIndex + direction + sequentialNavigableNodes.length) % sequentialNavigableNodes.length;
                const nextNode = sequentialNavigableNodes[highlightedNodeIndex];
                const parentNode = hierarchyRoot.children.find(c => c._children.some(child => child.id === nextNode.id));
                let needsUpdate = false;
                if (parentNode && !parentNode.children) {
                    parentNode.children = parentNode._children;
                    needsUpdate = true;
                }
                if (needsUpdate) { updateGraph(() => { highlightNode(nextNode.id); }); } 
                else { highlightNode(nextNode.id); }
            }

            // --- EVENT LISTENERS ---
            document.getElementById('close-modal-info').addEventListener('click', () => infoModal.classList.remove('active'));
            infoModal.addEventListener('click', (e) => e.target === infoModal && infoModal.classList.remove('active'));
            
            themeToggleButton.addEventListener('click', () => {
                const isDark = document.body.classList.toggle('dark');
                themeIconLight.classList.toggle('hidden', isDark);
                themeIconDark.classList.toggle('hidden', !isDark);
            });

            document.getElementById('share-btn').addEventListener('click', () => {
                document.getElementById('share-url').value = window.location.href;
                shareModal.classList.add('active');
            });
            document.getElementById('close-modal-share').addEventListener('click', () => shareModal.classList.remove('active'));
            shareModal.addEventListener('click', (e) => e.target === shareModal && shareModal.classList.remove('active'));
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                const urlInput = document.getElementById('share-url');
                navigator.clipboard.writeText(urlInput.value).then(() => {
                    const feedback = document.getElementById('copy-feedback');
                    feedback.textContent = 'Link copied!';
                    setTimeout(() => feedback.textContent = '', 2000);
                });
            });

            window.addEventListener('resize', initializeGraph);
            menuToggleButton.addEventListener('click', () => toolbar.classList.toggle('expanded'));
            document.getElementById('home-btn').addEventListener('click', resetView);
            document.getElementById('toggle-all-btn').addEventListener('click', toggleAllNodes);
            document.getElementById('list-view-btn').addEventListener('click', toggleListView);
            document.getElementById('prev-btn').addEventListener('click', () => navigate(-1));
            document.getElementById('next-btn').addEventListener('click', () => navigate(1));
            
            window.addEventListener('keydown', (e) => {
                if (document.activeElement.tagName === 'INPUT' || infoModal.classList.contains('active') || shareModal.classList.contains('active')) return;
                if (e.key === 'ArrowRight') navigate(1);
                else if (e.key === 'ArrowLeft') navigate(-1);
            });

            initializeGraph();
        });
    </script>
</body>
</html>